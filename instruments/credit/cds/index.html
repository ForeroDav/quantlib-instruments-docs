
<!DOCTYPE html>

<html class="no-js" lang="en">
<head>
<meta charset="utf-8"/>
<meta content="width=device-width,initial-scale=1" name="viewport"/>
<meta content="Professional documentation for QuantLib-based financial instruments pricing and valuation" name="description"/>
<meta content="David Forero" name="author"/>
<link href="http://localhost:8000/instruments/credit/cds/" rel="canonical"/>
<link href="../../fixed_income/frn/" rel="prev"/>
<link href="../cds_index/" rel="next"/>
<link href="../../../assets/images/favicon.png" rel="icon"/>
<meta content="mkdocs-1.6.1, mkdocs-material-9.5.44" name="generator"/>
<title>Credit Default Swap - QuantLib Financial Instruments Documentation</title>
<link href="../../../assets/stylesheets/main.0253249f.min.css" rel="stylesheet"/>
<link href="../../../assets/stylesheets/palette.06af60db.min.css" rel="stylesheet"/>
<link crossorigin="" href="https://fonts.gstatic.com" rel="preconnect"/>
<link href="https://fonts.googleapis.com/css?family=Inter:300,300i,400,400i,700,700i%7CJetBrains+Mono:400,400i,700,700i&amp;display=fallback" rel="stylesheet"/>
<style>:root{--md-text-font:"Inter";--md-code-font:"JetBrains Mono"}</style>
<link href="../../../assets/_mkdocstrings.css" rel="stylesheet"/>
<link href="../../../assets/stylesheets/extra.css" rel="stylesheet"/>
<script>__md_scope=new URL("../../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
</head>
<body data-md-color-accent="teal" data-md-color-primary="custom" data-md-color-scheme="default" dir="ltr">
<input autocomplete="off" class="md-toggle" data-md-toggle="drawer" id="__drawer" type="checkbox"/>
<input autocomplete="off" class="md-toggle" data-md-toggle="search" id="__search" type="checkbox"/>
<label class="md-overlay" for="__drawer"></label>
<div data-md-component="skip">
<a class="md-skip" href="#credit-default-swap-cds">
          Skip to content
        </a>
</div>
<div data-md-component="announce">
</div>
<header class="md-header md-header--shadow md-header--lifted" data-md-component="header">
<nav aria-label="Header" class="md-header__inner md-grid">
<a aria-label="QuantLib Financial Instruments Documentation" class="md-header__button md-logo" data-md-component="logo" href="../../.." title="QuantLib Financial Instruments Documentation">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"></path></svg>
</a>
<label class="md-header__button md-icon" for="__drawer">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"></path></svg>
</label>
<div class="md-header__title" data-md-component="header-title">
<div class="md-header__ellipsis">
<div class="md-header__topic">
<span class="md-ellipsis">
            QuantLib Financial Instruments Documentation
          </span>
</div>
<div class="md-header__topic" data-md-component="header-topic">
<span class="md-ellipsis">
            
              Credit Default Swap
            
          </span>
</div>
</div>
</div>
<form class="md-header__option" data-md-component="palette">
<input aria-label="Switch to dark mode" class="md-option" data-md-color-accent="teal" data-md-color-media="" data-md-color-primary="custom" data-md-color-scheme="default" id="__palette_0" name="__palette" type="radio"/>
<label class="md-header__button md-icon" for="__palette_1" hidden="" title="Switch to dark mode">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="m17.75 4.09-2.53 1.94.91 3.06-2.63-1.81-2.63 1.81.91-3.06-2.53-1.94L12.44 4l1.06-3 1.06 3zm3.5 6.91-1.64 1.25.59 1.98-1.7-1.17-1.7 1.17.59-1.98L15.75 11l2.06-.05L18.5 9l.69 1.95zm-2.28 4.95c.83-.08 1.72 1.1 1.19 1.85-.32.45-.66.87-1.08 1.27C15.17 23 8.84 23 4.94 19.07c-3.91-3.9-3.91-10.24 0-14.14.4-.4.82-.76 1.27-1.08.75-.53 1.93.36 1.85 1.19-.27 2.86.69 5.83 2.89 8.02a9.96 9.96 0 0 0 8.02 2.89m-1.64 2.02a12.08 12.08 0 0 1-7.8-3.47c-2.17-2.19-3.33-5-3.49-7.82-2.81 3.14-2.7 7.96.31 10.98 3.02 3.01 7.84 3.12 10.98.31"></path></svg>
</label>
<input aria-label="Switch to light mode" class="md-option" data-md-color-accent="amber" data-md-color-media="" data-md-color-primary="custom" data-md-color-scheme="slate" id="__palette_1" name="__palette" type="radio"/>
<label class="md-header__button md-icon" for="__palette_0" hidden="" title="Switch to light mode">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M12 7a5 5 0 0 1 5 5 5 5 0 0 1-5 5 5 5 0 0 1-5-5 5 5 0 0 1 5-5m0 2a3 3 0 0 0-3 3 3 3 0 0 0 3 3 3 3 0 0 0 3-3 3 3 0 0 0-3-3m0-7 2.39 3.42C13.65 5.15 12.84 5 12 5s-1.65.15-2.39.42zM3.34 7l4.16-.35A7.2 7.2 0 0 0 5.94 8.5c-.44.74-.69 1.5-.83 2.29zm.02 10 1.76-3.77a7.131 7.131 0 0 0 2.38 4.14zM20.65 7l-1.77 3.79a7.02 7.02 0 0 0-2.38-4.15zm-.01 10-4.14.36c.59-.51 1.12-1.14 1.54-1.86.42-.73.69-1.5.83-2.29zM12 22l-2.41-3.44c.74.27 1.55.44 2.41.44.82 0 1.63-.17 2.37-.44z"></path></svg>
</label>
</form>
<script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
<label class="md-header__button md-icon" for="__search">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"></path></svg>
</label>
<div class="md-search" data-md-component="search" role="dialog">
<label class="md-search__overlay" for="__search"></label>
<div class="md-search__inner" role="search">
<form class="md-search__form" name="search">
<input aria-label="Search" autocapitalize="off" autocomplete="off" autocorrect="off" class="md-search__input" data-md-component="search-query" name="query" placeholder="Search" required="" spellcheck="false" type="text"/>
<label class="md-search__icon md-icon" for="__search">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"></path></svg>
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"></path></svg>
</label>
<nav aria-label="Search" class="md-search__options">
<a aria-label="Share" class="md-search__icon md-icon" data-clipboard="" data-clipboard-text="" data-md-component="search-share" href="javascript:void(0)" tabindex="-1" title="Share">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M18 16.08c-.76 0-1.44.3-1.96.77L8.91 12.7c.05-.23.09-.46.09-.7s-.04-.47-.09-.7l7.05-4.11c.54.5 1.25.81 2.04.81a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3c0 .24.04.47.09.7L8.04 9.81C7.5 9.31 6.79 9 6 9a3 3 0 0 0-3 3 3 3 0 0 0 3 3c.79 0 1.5-.31 2.04-.81l7.12 4.15c-.05.21-.08.43-.08.66 0 1.61 1.31 2.91 2.92 2.91s2.92-1.3 2.92-2.91A2.92 2.92 0 0 0 18 16.08"></path></svg>
</a>
<button aria-label="Clear" class="md-search__icon md-icon" tabindex="-1" title="Clear" type="reset">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"></path></svg>
</button>
</nav>
<div class="md-search__suggest" data-md-component="search-suggest"></div>
</form>
<div class="md-search__output">
<div class="md-search__scrollwrap" data-md-scrollfix="" tabindex="0">
<div class="md-search-result" data-md-component="search-result">
<div class="md-search-result__meta">
            Initializing search
          </div>
<ol class="md-search-result__list" role="presentation"></ol>
</div>
</div>
</div>
</div>
</div>
</nav>
<nav aria-label="Tabs" class="md-tabs" data-md-component="tabs">
<div class="md-grid">
<ul class="md-tabs__list">
<li class="md-tabs__item">
<a class="md-tabs__link" href="../../..">
        
  
    
  
  Home

      </a>
</li>
<li class="md-tabs__item">
<a class="md-tabs__link" href="../../../guides/installation/">
          
  
    
  
  Getting Started

        </a>
</li>
<li class="md-tabs__item">
<a class="md-tabs__link" href="../../../guides/models/black_scholes/">
          
  
    
  
  Pricing Models

        </a>
</li>
<li class="md-tabs__item md-tabs__item--active">
<a class="md-tabs__link" href="../../">
          
  
    
  
  Instruments

        </a>
</li>
<li class="md-tabs__item">
<a class="md-tabs__link" href="../../../examples/basic_pricing/">
          
  
    
  
  Examples

        </a>
</li>
<li class="md-tabs__item">
<a class="md-tabs__link" href="../../../api/">
        
  
    
  
  API Reference

      </a>
</li>
</ul>
</div>
</nav>
</header>
<div class="md-container" data-md-component="container">
<main class="md-main" data-md-component="main">
<div class="md-main__inner md-grid">
<div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation">
<div class="md-sidebar__scrollwrap">
<div class="md-sidebar__inner">
<nav aria-label="Navigation" class="md-nav md-nav--primary md-nav--lifted md-nav--integrated" data-md-level="0">
<label class="md-nav__title" for="__drawer">
<a aria-label="QuantLib Financial Instruments Documentation" class="md-nav__button md-logo" data-md-component="logo" href="../../.." title="QuantLib Financial Instruments Documentation">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"></path></svg>
</a>
    QuantLib Financial Instruments Documentation
  </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../..">
<span class="md-ellipsis">
    Home
  </span>
</a>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle md-toggle--indeterminate" id="__nav_2" type="checkbox"/>
<label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="0">
<span class="md-ellipsis">
    Getting Started
  </span>
<span class="md-nav__icon md-icon"></span>
</label>
<nav aria-expanded="false" aria-labelledby="__nav_2_label" class="md-nav" data-md-level="1">
<label class="md-nav__title" for="__nav_2">
<span class="md-nav__icon md-icon"></span>
            Getting Started
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../../guides/installation/">
<span class="md-ellipsis">
    Installation
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../guides/quickstart/">
<span class="md-ellipsis">
    Quick Start
  </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle md-toggle--indeterminate" id="__nav_3" type="checkbox"/>
<label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="0">
<span class="md-ellipsis">
    Pricing Models
  </span>
<span class="md-nav__icon md-icon"></span>
</label>
<nav aria-expanded="false" aria-labelledby="__nav_3_label" class="md-nav" data-md-level="1">
<label class="md-nav__title" for="__nav_3">
<span class="md-nav__icon md-icon"></span>
            Pricing Models
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../../guides/models/black_scholes/">
<span class="md-ellipsis">
    Black-Scholes
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../guides/models/binomial/">
<span class="md-ellipsis">
    Binomial Trees
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../guides/models/monte_carlo/">
<span class="md-ellipsis">
    Monte Carlo Simulation
  </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
<input checked="" class="md-nav__toggle md-toggle" id="__nav_4" type="checkbox"/>
<div class="md-nav__link md-nav__container">
<a class="md-nav__link" href="../../">
<span class="md-ellipsis">
    Instruments
  </span>
</a>
<label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="">
<span class="md-nav__icon md-icon"></span>
</label>
</div>
<nav aria-expanded="true" aria-labelledby="__nav_4_label" class="md-nav" data-md-level="1">
<label class="md-nav__title" for="__nav_4">
<span class="md-nav__icon md-icon"></span>
            Instruments
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item md-nav__item--section md-nav__item--nested">
<input class="md-nav__toggle md-toggle md-toggle--indeterminate" id="__nav_4_2" type="checkbox"/>
<label class="md-nav__link" for="__nav_4_2" id="__nav_4_2_label" tabindex="">
<span class="md-ellipsis">
    Equity
  </span>
<span class="md-nav__icon md-icon"></span>
</label>
<nav aria-expanded="false" aria-labelledby="__nav_4_2_label" class="md-nav" data-md-level="2">
<label class="md-nav__title" for="__nav_4_2">
<span class="md-nav__icon md-icon"></span>
            Equity
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../equity/equity_swap/">
<span class="md-ellipsis">
    Equity Swap
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../equity/equity_index_swap/">
<span class="md-ellipsis">
    Equity Index Swap
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../equity/american_warrant/">
<span class="md-ellipsis">
    American Warrant
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../equity/american_option/">
<span class="md-ellipsis">
    American Option
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../equity/european_option/">
<span class="md-ellipsis">
    European Option
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../equity/index_futures/">
<span class="md-ellipsis">
    Index Futures
  </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--section md-nav__item--nested">
<input class="md-nav__toggle md-toggle md-toggle--indeterminate" id="__nav_4_3" type="checkbox"/>
<label class="md-nav__link" for="__nav_4_3" id="__nav_4_3_label" tabindex="">
<span class="md-ellipsis">
    Fixed Income
  </span>
<span class="md-nav__icon md-icon"></span>
</label>
<nav aria-expanded="false" aria-labelledby="__nav_4_3_label" class="md-nav" data-md-level="2">
<label class="md-nav__title" for="__nav_4_3">
<span class="md-nav__icon md-icon"></span>
            Fixed Income
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../fixed_income/treasury_bond/">
<span class="md-ellipsis">
    Treasury Bond
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../fixed_income/callable_bond/">
<span class="md-ellipsis">
    Callable Bond
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../fixed_income/frn/">
<span class="md-ellipsis">
    Floating Rate Note
  </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
<input checked="" class="md-nav__toggle md-toggle" id="__nav_4_4" type="checkbox"/>
<label class="md-nav__link" for="__nav_4_4" id="__nav_4_4_label" tabindex="">
<span class="md-ellipsis">
    Credit
  </span>
<span class="md-nav__icon md-icon"></span>
</label>
<nav aria-expanded="true" aria-labelledby="__nav_4_4_label" class="md-nav" data-md-level="2">
<label class="md-nav__title" for="__nav_4_4">
<span class="md-nav__icon md-icon"></span>
            Credit
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item md-nav__item--active">
<input class="md-nav__toggle md-toggle" id="__toc" type="checkbox"/>
<label class="md-nav__link md-nav__link--active" for="__toc">
<span class="md-ellipsis">
    Credit Default Swap
  </span>
<span class="md-nav__icon md-icon"></span>
</label>
<a class="md-nav__link md-nav__link--active" href="./">
<span class="md-ellipsis">
    Credit Default Swap
  </span>
</a>
<nav aria-label="Table of contents" class="md-nav md-nav--secondary">
<label class="md-nav__title" for="__toc">
<span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
<ul class="md-nav__list" data-md-component="toc" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="#overview">
<span class="md-ellipsis">
      Overview
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#key-features">
<span class="md-ellipsis">
      üí° Key Features
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#python-class-implementation">
<span class="md-ellipsis">
      üìê Python Class Implementation
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#usage-examples">
<span class="md-ellipsis">
      üìä Usage Examples
    </span>
</a>
<nav aria-label="üìä Usage Examples" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#example-1-create-a-5-year-cds">
<span class="md-ellipsis">
      Example 1: Create a 5-Year CDS
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#example-2-calculate-fair-spread">
<span class="md-ellipsis">
      Example 2: Calculate Fair Spread
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#example-3-calculate-cds-valuation-mark-to-market">
<span class="md-ellipsis">
      Example 3: Calculate CDS Valuation (Mark-to-Market)
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#example-4-risk-metrics-dv01">
<span class="md-ellipsis">
      Example 4: Risk Metrics (DV01)
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#example-5-premium-leg-cash-flows">
<span class="md-ellipsis">
      Example 5: Premium Leg Cash Flows
    </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#use-cases">
<span class="md-ellipsis">
      üéØ Use Cases
    </span>
</a>
<nav aria-label="üéØ Use Cases" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#1-credit-hedging">
<span class="md-ellipsis">
      1. Credit Hedging
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#2-credit-arbitrage">
<span class="md-ellipsis">
      2. Credit Arbitrage
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#3-credit-curve-trading">
<span class="md-ellipsis">
      3. Credit Curve Trading
    </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#advanced-pricing-with-quantlib">
<span class="md-ellipsis">
      üìà Advanced Pricing with QuantLib
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#related-instruments">
<span class="md-ellipsis">
      üîó Related Instruments
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#references">
<span class="md-ellipsis">
      üìö References
    </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#important-notes">
<span class="md-ellipsis">
      ‚ö†Ô∏è Important Notes
    </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../cds_index/">
<span class="md-ellipsis">
    CDS Index
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../cdx_options/">
<span class="md-ellipsis">
    CDX/iTraxx Options
  </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--section md-nav__item--nested">
<input class="md-nav__toggle md-toggle md-toggle--indeterminate" id="__nav_4_5" type="checkbox"/>
<label class="md-nav__link" for="__nav_4_5" id="__nav_4_5_label" tabindex="">
<span class="md-ellipsis">
    Interest Rates
  </span>
<span class="md-nav__icon md-icon"></span>
</label>
<nav aria-expanded="false" aria-labelledby="__nav_4_5_label" class="md-nav" data-md-level="2">
<label class="md-nav__title" for="__nav_4_5">
<span class="md-nav__icon md-icon"></span>
            Interest Rates
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../rates/irs/">
<span class="md-ellipsis">
    Interest Rate Swap
  </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--section md-nav__item--nested">
<input class="md-nav__toggle md-toggle md-toggle--indeterminate" id="__nav_4_6" type="checkbox"/>
<label class="md-nav__link" for="__nav_4_6" id="__nav_4_6_label" tabindex="">
<span class="md-ellipsis">
    FX
  </span>
<span class="md-nav__icon md-icon"></span>
</label>
<nav aria-expanded="false" aria-labelledby="__nav_4_6_label" class="md-nav" data-md-level="2">
<label class="md-nav__title" for="__nav_4_6">
<span class="md-nav__icon md-icon"></span>
            FX
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../fx/currency_forward/">
<span class="md-ellipsis">
    Currency Forward
  </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--section md-nav__item--nested">
<input class="md-nav__toggle md-toggle md-toggle--indeterminate" id="__nav_4_7" type="checkbox"/>
<label class="md-nav__link" for="__nav_4_7" id="__nav_4_7_label" tabindex="">
<span class="md-ellipsis">
    Cash Flow
  </span>
<span class="md-nav__icon md-icon"></span>
</label>
<nav aria-expanded="false" aria-labelledby="__nav_4_7_label" class="md-nav" data-md-level="2">
<label class="md-nav__title" for="__nav_4_7">
<span class="md-nav__icon md-icon"></span>
            Cash Flow
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../cashflow/overview/">
<span class="md-ellipsis">
    Overview
  </span>
</a>
</li>
</ul>
</nav>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle md-toggle--indeterminate" id="__nav_5" type="checkbox"/>
<label class="md-nav__link" for="__nav_5" id="__nav_5_label" tabindex="0">
<span class="md-ellipsis">
    Examples
  </span>
<span class="md-nav__icon md-icon"></span>
</label>
<nav aria-expanded="false" aria-labelledby="__nav_5_label" class="md-nav" data-md-level="1">
<label class="md-nav__title" for="__nav_5">
<span class="md-nav__icon md-icon"></span>
            Examples
          </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../../examples/basic_pricing/">
<span class="md-ellipsis">
    Basic Instrument Pricing with QuantLib
  </span>
</a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../examples/advanced_valuation/">
<span class="md-ellipsis">
    Advanced Valuation Techniques
  </span>
</a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../api/">
<span class="md-ellipsis">
    API Reference
  </span>
</a>
</li>
</ul>
</nav>
</div>
</div>
</div>
<div class="md-content" data-md-component="content">
<article class="md-content__inner md-typeset">
<h1 id="credit-default-swap-cds">Credit Default Swap (CDS)<a class="headerlink" href="#credit-default-swap-cds" title="Permanent link">¬∂</a></h1>
<p><span class="category-badge badge-credit">CREDIT</span></p>
<p>Derivative contract providing protection against credit default events.</p>
<h2 id="overview">Overview<a class="headerlink" href="#overview" title="Permanent link">¬∂</a></h2>
<p><strong>Class:</strong> <code>CreditDefaultSwap</code>
<strong>Category:</strong> Credit Derivatives
<strong>Type:</strong> Credit Protection</p>
<p>A Credit Default Swap is a bilateral financial derivative contract where the buyer makes periodic premium payments to the seller in exchange for protection against a credit event (default, bankruptcy, restructuring) of a reference entity. If a credit event occurs, the seller compensates the buyer for the loss.</p>
<h2 id="key-features">üí° Key Features<a class="headerlink" href="#key-features" title="Permanent link">¬∂</a></h2>
<ul>
<li><strong>Credit Protection</strong>: Transfer credit risk without selling the underlying asset</li>
<li><strong>Premium Payments</strong>: Quarterly or semi-annual premium payments (spread)</li>
<li><strong>Credit Events</strong>: Default, bankruptcy, failure to pay, restructuring</li>
<li><strong>Settlement</strong>: Cash or physical settlement upon credit event</li>
<li><strong>ISDA Standard</strong>: Industry-standard documentation and pricing</li>
</ul>
<h2 id="python-class-implementation">üìê Python Class Implementation<a class="headerlink" href="#python-class-implementation" title="Permanent link">¬∂</a></h2>
<div class="highlight"><pre><span></span><code><a href="#__codelineno-0-1" id="__codelineno-0-1" name="__codelineno-0-1"></a><span class="kn">from</span><span class="w"> </span><span class="nn">dataclasses</span><span class="w"> </span><span class="kn">import</span> <span class="n">dataclass</span>
<a href="#__codelineno-0-2" id="__codelineno-0-2" name="__codelineno-0-2"></a><span class="kn">from</span><span class="w"> </span><span class="nn">datetime</span><span class="w"> </span><span class="kn">import</span> <span class="n">datetime</span>
<a href="#__codelineno-0-3" id="__codelineno-0-3" name="__codelineno-0-3"></a><span class="kn">from</span><span class="w"> </span><span class="nn">typing</span><span class="w"> </span><span class="kn">import</span> <span class="n">List</span><span class="p">,</span> <span class="n">Optional</span>
<a href="#__codelineno-0-4" id="__codelineno-0-4" name="__codelineno-0-4"></a><span class="kn">from</span><span class="w"> </span><span class="nn">enum</span><span class="w"> </span><span class="kn">import</span> <span class="n">Enum</span>
<a href="#__codelineno-0-5" id="__codelineno-0-5" name="__codelineno-0-5"></a><span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
<a href="#__codelineno-0-6" id="__codelineno-0-6" name="__codelineno-0-6"></a>
<a href="#__codelineno-0-7" id="__codelineno-0-7" name="__codelineno-0-7"></a><span class="k">class</span><span class="w"> </span><span class="nc">CreditEvent</span><span class="p">(</span><span class="n">Enum</span><span class="p">):</span>
<a href="#__codelineno-0-8" id="__codelineno-0-8" name="__codelineno-0-8"></a><span class="w">    </span><span class="sd">"""Types of credit events"""</span>
<a href="#__codelineno-0-9" id="__codelineno-0-9" name="__codelineno-0-9"></a>    <span class="n">BANKRUPTCY</span> <span class="o">=</span> <span class="s2">"bankruptcy"</span>
<a href="#__codelineno-0-10" id="__codelineno-0-10" name="__codelineno-0-10"></a>    <span class="n">FAILURE_TO_PAY</span> <span class="o">=</span> <span class="s2">"failure_to_pay"</span>
<a href="#__codelineno-0-11" id="__codelineno-0-11" name="__codelineno-0-11"></a>    <span class="n">RESTRUCTURING</span> <span class="o">=</span> <span class="s2">"restructuring"</span>
<a href="#__codelineno-0-12" id="__codelineno-0-12" name="__codelineno-0-12"></a>    <span class="n">DEFAULT</span> <span class="o">=</span> <span class="s2">"default"</span>
<a href="#__codelineno-0-13" id="__codelineno-0-13" name="__codelineno-0-13"></a>
<a href="#__codelineno-0-14" id="__codelineno-0-14" name="__codelineno-0-14"></a><span class="k">class</span><span class="w"> </span><span class="nc">SettlementType</span><span class="p">(</span><span class="n">Enum</span><span class="p">):</span>
<a href="#__codelineno-0-15" id="__codelineno-0-15" name="__codelineno-0-15"></a><span class="w">    </span><span class="sd">"""CDS settlement methods"""</span>
<a href="#__codelineno-0-16" id="__codelineno-0-16" name="__codelineno-0-16"></a>    <span class="n">CASH</span> <span class="o">=</span> <span class="s2">"cash"</span>
<a href="#__codelineno-0-17" id="__codelineno-0-17" name="__codelineno-0-17"></a>    <span class="n">PHYSICAL</span> <span class="o">=</span> <span class="s2">"physical"</span>
<a href="#__codelineno-0-18" id="__codelineno-0-18" name="__codelineno-0-18"></a>
<a href="#__codelineno-0-19" id="__codelineno-0-19" name="__codelineno-0-19"></a><span class="nd">@dataclass</span>
<a href="#__codelineno-0-20" id="__codelineno-0-20" name="__codelineno-0-20"></a><span class="k">class</span><span class="w"> </span><span class="nc">PremiumPayment</span><span class="p">:</span>
<a href="#__codelineno-0-21" id="__codelineno-0-21" name="__codelineno-0-21"></a><span class="w">    </span><span class="sd">"""Single premium payment"""</span>
<a href="#__codelineno-0-22" id="__codelineno-0-22" name="__codelineno-0-22"></a>    <span class="n">payment_date</span><span class="p">:</span> <span class="n">datetime</span>
<a href="#__codelineno-0-23" id="__codelineno-0-23" name="__codelineno-0-23"></a>    <span class="n">premium_amount</span><span class="p">:</span> <span class="nb">float</span>
<a href="#__codelineno-0-24" id="__codelineno-0-24" name="__codelineno-0-24"></a>    <span class="n">accrued_days</span><span class="p">:</span> <span class="nb">int</span>
<a href="#__codelineno-0-25" id="__codelineno-0-25" name="__codelineno-0-25"></a>    <span class="n">survival_probability</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">1.0</span>
<a href="#__codelineno-0-26" id="__codelineno-0-26" name="__codelineno-0-26"></a>
<a href="#__codelineno-0-27" id="__codelineno-0-27" name="__codelineno-0-27"></a><span class="nd">@dataclass</span>
<a href="#__codelineno-0-28" id="__codelineno-0-28" name="__codelineno-0-28"></a><span class="k">class</span><span class="w"> </span><span class="nc">CDSCashFlows</span><span class="p">:</span>
<a href="#__codelineno-0-29" id="__codelineno-0-29" name="__codelineno-0-29"></a><span class="w">    </span><span class="sd">"""All cash flows for a CDS"""</span>
<a href="#__codelineno-0-30" id="__codelineno-0-30" name="__codelineno-0-30"></a>    <span class="n">premium_leg</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">PremiumPayment</span><span class="p">]</span>
<a href="#__codelineno-0-31" id="__codelineno-0-31" name="__codelineno-0-31"></a>    <span class="n">protection_leg_pv</span><span class="p">:</span> <span class="nb">float</span>
<a href="#__codelineno-0-32" id="__codelineno-0-32" name="__codelineno-0-32"></a>    <span class="n">upfront_fee</span><span class="p">:</span> <span class="nb">float</span>
<a href="#__codelineno-0-33" id="__codelineno-0-33" name="__codelineno-0-33"></a>    <span class="n">total_pv</span><span class="p">:</span> <span class="nb">float</span>
<a href="#__codelineno-0-34" id="__codelineno-0-34" name="__codelineno-0-34"></a>
<a href="#__codelineno-0-35" id="__codelineno-0-35" name="__codelineno-0-35"></a><span class="k">class</span><span class="w"> </span><span class="nc">CreditDefaultSwap</span><span class="p">:</span>
<a href="#__codelineno-0-36" id="__codelineno-0-36" name="__codelineno-0-36"></a><span class="w">    </span><span class="sd">"""</span>
<a href="#__codelineno-0-37" id="__codelineno-0-37" name="__codelineno-0-37"></a><span class="sd">    Complete implementation of a Credit Default Swap</span>
<a href="#__codelineno-0-38" id="__codelineno-0-38" name="__codelineno-0-38"></a>
<a href="#__codelineno-0-39" id="__codelineno-0-39" name="__codelineno-0-39"></a><span class="sd">    Attributes:</span>
<a href="#__codelineno-0-40" id="__codelineno-0-40" name="__codelineno-0-40"></a><span class="sd">        notional: Notional amount of protection</span>
<a href="#__codelineno-0-41" id="__codelineno-0-41" name="__codelineno-0-41"></a><span class="sd">        spread: CDS spread in basis points (e.g., 100 for 100 bps = 1%)</span>
<a href="#__codelineno-0-42" id="__codelineno-0-42" name="__codelineno-0-42"></a><span class="sd">        recovery_rate: Expected recovery rate on default (typically 0.40 for senior unsecured)</span>
<a href="#__codelineno-0-43" id="__codelineno-0-43" name="__codelineno-0-43"></a><span class="sd">        start_date: Protection start date</span>
<a href="#__codelineno-0-44" id="__codelineno-0-44" name="__codelineno-0-44"></a><span class="sd">        maturity_date: Protection end date</span>
<a href="#__codelineno-0-45" id="__codelineno-0-45" name="__codelineno-0-45"></a><span class="sd">        payment_frequency: Premium payments per year (typically 4 for quarterly)</span>
<a href="#__codelineno-0-46" id="__codelineno-0-46" name="__codelineno-0-46"></a><span class="sd">        upfront_fee: Initial upfront payment (can be negative)</span>
<a href="#__codelineno-0-47" id="__codelineno-0-47" name="__codelineno-0-47"></a><span class="sd">        position: 'buyer' (protection buyer) or 'seller' (protection seller)</span>
<a href="#__codelineno-0-48" id="__codelineno-0-48" name="__codelineno-0-48"></a><span class="sd">    """</span>
<a href="#__codelineno-0-49" id="__codelineno-0-49" name="__codelineno-0-49"></a>
<a href="#__codelineno-0-50" id="__codelineno-0-50" name="__codelineno-0-50"></a>    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span>
<a href="#__codelineno-0-51" id="__codelineno-0-51" name="__codelineno-0-51"></a>        <span class="bp">self</span><span class="p">,</span>
<a href="#__codelineno-0-52" id="__codelineno-0-52" name="__codelineno-0-52"></a>        <span class="n">notional</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
<a href="#__codelineno-0-53" id="__codelineno-0-53" name="__codelineno-0-53"></a>        <span class="n">spread</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>  <span class="c1"># In basis points</span>
<a href="#__codelineno-0-54" id="__codelineno-0-54" name="__codelineno-0-54"></a>        <span class="n">recovery_rate</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
<a href="#__codelineno-0-55" id="__codelineno-0-55" name="__codelineno-0-55"></a>        <span class="n">start_date</span><span class="p">:</span> <span class="n">datetime</span><span class="p">,</span>
<a href="#__codelineno-0-56" id="__codelineno-0-56" name="__codelineno-0-56"></a>        <span class="n">maturity_date</span><span class="p">:</span> <span class="n">datetime</span><span class="p">,</span>
<a href="#__codelineno-0-57" id="__codelineno-0-57" name="__codelineno-0-57"></a>        <span class="n">payment_frequency</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">4</span><span class="p">,</span>  <span class="c1"># Quarterly</span>
<a href="#__codelineno-0-58" id="__codelineno-0-58" name="__codelineno-0-58"></a>        <span class="n">upfront_fee</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.0</span><span class="p">,</span>
<a href="#__codelineno-0-59" id="__codelineno-0-59" name="__codelineno-0-59"></a>        <span class="n">position</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">"buyer"</span>
<a href="#__codelineno-0-60" id="__codelineno-0-60" name="__codelineno-0-60"></a>    <span class="p">):</span>
<a href="#__codelineno-0-61" id="__codelineno-0-61" name="__codelineno-0-61"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">notional</span> <span class="o">=</span> <span class="n">notional</span>
<a href="#__codelineno-0-62" id="__codelineno-0-62" name="__codelineno-0-62"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">spread</span> <span class="o">=</span> <span class="n">spread</span> <span class="o">/</span> <span class="mf">10000.0</span>  <span class="c1"># Convert bps to decimal</span>
<a href="#__codelineno-0-63" id="__codelineno-0-63" name="__codelineno-0-63"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">recovery_rate</span> <span class="o">=</span> <span class="n">recovery_rate</span>
<a href="#__codelineno-0-64" id="__codelineno-0-64" name="__codelineno-0-64"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">start_date</span> <span class="o">=</span> <span class="n">start_date</span>
<a href="#__codelineno-0-65" id="__codelineno-0-65" name="__codelineno-0-65"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">maturity_date</span> <span class="o">=</span> <span class="n">maturity_date</span>
<a href="#__codelineno-0-66" id="__codelineno-0-66" name="__codelineno-0-66"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">payment_frequency</span> <span class="o">=</span> <span class="n">payment_frequency</span>
<a href="#__codelineno-0-67" id="__codelineno-0-67" name="__codelineno-0-67"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">upfront_fee</span> <span class="o">=</span> <span class="n">upfront_fee</span>
<a href="#__codelineno-0-68" id="__codelineno-0-68" name="__codelineno-0-68"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">position</span> <span class="o">=</span> <span class="n">position</span>
<a href="#__codelineno-0-69" id="__codelineno-0-69" name="__codelineno-0-69"></a>
<a href="#__codelineno-0-70" id="__codelineno-0-70" name="__codelineno-0-70"></a>        <span class="c1"># Validate</span>
<a href="#__codelineno-0-71" id="__codelineno-0-71" name="__codelineno-0-71"></a>        <span class="k">if</span> <span class="n">position</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">'buyer'</span><span class="p">,</span> <span class="s1">'seller'</span><span class="p">]:</span>
<a href="#__codelineno-0-72" id="__codelineno-0-72" name="__codelineno-0-72"></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">"Position must be 'buyer' or 'seller'"</span><span class="p">)</span>
<a href="#__codelineno-0-73" id="__codelineno-0-73" name="__codelineno-0-73"></a>        <span class="k">if</span> <span class="n">maturity_date</span> <span class="o">&lt;=</span> <span class="n">start_date</span><span class="p">:</span>
<a href="#__codelineno-0-74" id="__codelineno-0-74" name="__codelineno-0-74"></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">"Maturity must be after start date"</span><span class="p">)</span>
<a href="#__codelineno-0-75" id="__codelineno-0-75" name="__codelineno-0-75"></a>        <span class="k">if</span> <span class="n">recovery_rate</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="ow">or</span> <span class="n">recovery_rate</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
<a href="#__codelineno-0-76" id="__codelineno-0-76" name="__codelineno-0-76"></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">"Recovery rate must be between 0 and 1"</span><span class="p">)</span>
<a href="#__codelineno-0-77" id="__codelineno-0-77" name="__codelineno-0-77"></a>        <span class="k">if</span> <span class="n">notional</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">:</span>
<a href="#__codelineno-0-78" id="__codelineno-0-78" name="__codelineno-0-78"></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">"Notional must be positive"</span><span class="p">)</span>
<a href="#__codelineno-0-79" id="__codelineno-0-79" name="__codelineno-0-79"></a>
<a href="#__codelineno-0-80" id="__codelineno-0-80" name="__codelineno-0-80"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">generate_payment_schedule</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">datetime</span><span class="p">]:</span>
<a href="#__codelineno-0-81" id="__codelineno-0-81" name="__codelineno-0-81"></a><span class="w">        </span><span class="sd">"""</span>
<a href="#__codelineno-0-82" id="__codelineno-0-82" name="__codelineno-0-82"></a><span class="sd">        Generate premium payment dates (typically quarterly)</span>
<a href="#__codelineno-0-83" id="__codelineno-0-83" name="__codelineno-0-83"></a>
<a href="#__codelineno-0-84" id="__codelineno-0-84" name="__codelineno-0-84"></a><span class="sd">        Returns:</span>
<a href="#__codelineno-0-85" id="__codelineno-0-85" name="__codelineno-0-85"></a><span class="sd">            List of payment dates</span>
<a href="#__codelineno-0-86" id="__codelineno-0-86" name="__codelineno-0-86"></a><span class="sd">        """</span>
<a href="#__codelineno-0-87" id="__codelineno-0-87" name="__codelineno-0-87"></a>        <span class="n">schedule</span> <span class="o">=</span> <span class="p">[]</span>
<a href="#__codelineno-0-88" id="__codelineno-0-88" name="__codelineno-0-88"></a>        <span class="n">current</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">start_date</span>
<a href="#__codelineno-0-89" id="__codelineno-0-89" name="__codelineno-0-89"></a>        <span class="n">months_per_payment</span> <span class="o">=</span> <span class="mi">12</span> <span class="o">//</span> <span class="bp">self</span><span class="o">.</span><span class="n">payment_frequency</span>
<a href="#__codelineno-0-90" id="__codelineno-0-90" name="__codelineno-0-90"></a>
<a href="#__codelineno-0-91" id="__codelineno-0-91" name="__codelineno-0-91"></a>        <span class="k">while</span> <span class="n">current</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">maturity_date</span><span class="p">:</span>
<a href="#__codelineno-0-92" id="__codelineno-0-92" name="__codelineno-0-92"></a>            <span class="n">month</span> <span class="o">=</span> <span class="n">current</span><span class="o">.</span><span class="n">month</span> <span class="o">+</span> <span class="n">months_per_payment</span>
<a href="#__codelineno-0-93" id="__codelineno-0-93" name="__codelineno-0-93"></a>            <span class="n">year</span> <span class="o">=</span> <span class="n">current</span><span class="o">.</span><span class="n">year</span> <span class="o">+</span> <span class="p">(</span><span class="n">month</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">//</span> <span class="mi">12</span>
<a href="#__codelineno-0-94" id="__codelineno-0-94" name="__codelineno-0-94"></a>            <span class="n">month</span> <span class="o">=</span> <span class="p">((</span><span class="n">month</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">%</span> <span class="mi">12</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span>
<a href="#__codelineno-0-95" id="__codelineno-0-95" name="__codelineno-0-95"></a>
<a href="#__codelineno-0-96" id="__codelineno-0-96" name="__codelineno-0-96"></a>            <span class="c1"># Standard CDS dates: 20th of month</span>
<a href="#__codelineno-0-97" id="__codelineno-0-97" name="__codelineno-0-97"></a>            <span class="k">try</span><span class="p">:</span>
<a href="#__codelineno-0-98" id="__codelineno-0-98" name="__codelineno-0-98"></a>                <span class="n">current</span> <span class="o">=</span> <span class="n">datetime</span><span class="p">(</span><span class="n">year</span><span class="p">,</span> <span class="n">month</span><span class="p">,</span> <span class="mi">20</span><span class="p">)</span>
<a href="#__codelineno-0-99" id="__codelineno-0-99" name="__codelineno-0-99"></a>            <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
<a href="#__codelineno-0-100" id="__codelineno-0-100" name="__codelineno-0-100"></a>                <span class="n">current</span> <span class="o">=</span> <span class="n">datetime</span><span class="p">(</span><span class="n">year</span><span class="p">,</span> <span class="n">month</span><span class="p">,</span> <span class="mi">28</span><span class="p">)</span>
<a href="#__codelineno-0-101" id="__codelineno-0-101" name="__codelineno-0-101"></a>
<a href="#__codelineno-0-102" id="__codelineno-0-102" name="__codelineno-0-102"></a>            <span class="k">if</span> <span class="n">current</span> <span class="o">&lt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">maturity_date</span><span class="p">:</span>
<a href="#__codelineno-0-103" id="__codelineno-0-103" name="__codelineno-0-103"></a>                <span class="n">schedule</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">current</span><span class="p">)</span>
<a href="#__codelineno-0-104" id="__codelineno-0-104" name="__codelineno-0-104"></a>
<a href="#__codelineno-0-105" id="__codelineno-0-105" name="__codelineno-0-105"></a>        <span class="c1"># Ensure maturity is included</span>
<a href="#__codelineno-0-106" id="__codelineno-0-106" name="__codelineno-0-106"></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">schedule</span> <span class="ow">or</span> <span class="n">schedule</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">maturity_date</span><span class="p">:</span>
<a href="#__codelineno-0-107" id="__codelineno-0-107" name="__codelineno-0-107"></a>            <span class="n">schedule</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">maturity_date</span><span class="p">)</span>
<a href="#__codelineno-0-108" id="__codelineno-0-108" name="__codelineno-0-108"></a>
<a href="#__codelineno-0-109" id="__codelineno-0-109" name="__codelineno-0-109"></a>        <span class="k">return</span> <span class="n">schedule</span>
<a href="#__codelineno-0-110" id="__codelineno-0-110" name="__codelineno-0-110"></a>
<a href="#__codelineno-0-111" id="__codelineno-0-111" name="__codelineno-0-111"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">calculate_hazard_rate</span><span class="p">(</span>
<a href="#__codelineno-0-112" id="__codelineno-0-112" name="__codelineno-0-112"></a>        <span class="bp">self</span><span class="p">,</span>
<a href="#__codelineno-0-113" id="__codelineno-0-113" name="__codelineno-0-113"></a>        <span class="n">survival_probability</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
<a href="#__codelineno-0-114" id="__codelineno-0-114" name="__codelineno-0-114"></a>        <span class="n">time_years</span><span class="p">:</span> <span class="nb">float</span>
<a href="#__codelineno-0-115" id="__codelineno-0-115" name="__codelineno-0-115"></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
<a href="#__codelineno-0-116" id="__codelineno-0-116" name="__codelineno-0-116"></a><span class="w">        </span><span class="sd">"""</span>
<a href="#__codelineno-0-117" id="__codelineno-0-117" name="__codelineno-0-117"></a><span class="sd">        Calculate constant hazard rate from survival probability</span>
<a href="#__codelineno-0-118" id="__codelineno-0-118" name="__codelineno-0-118"></a>
<a href="#__codelineno-0-119" id="__codelineno-0-119" name="__codelineno-0-119"></a><span class="sd">        Args:</span>
<a href="#__codelineno-0-120" id="__codelineno-0-120" name="__codelineno-0-120"></a><span class="sd">            survival_probability: Probability of no default</span>
<a href="#__codelineno-0-121" id="__codelineno-0-121" name="__codelineno-0-121"></a><span class="sd">            time_years: Time period in years</span>
<a href="#__codelineno-0-122" id="__codelineno-0-122" name="__codelineno-0-122"></a>
<a href="#__codelineno-0-123" id="__codelineno-0-123" name="__codelineno-0-123"></a><span class="sd">        Returns:</span>
<a href="#__codelineno-0-124" id="__codelineno-0-124" name="__codelineno-0-124"></a><span class="sd">            Hazard rate (intensity)</span>
<a href="#__codelineno-0-125" id="__codelineno-0-125" name="__codelineno-0-125"></a><span class="sd">        """</span>
<a href="#__codelineno-0-126" id="__codelineno-0-126" name="__codelineno-0-126"></a>        <span class="k">if</span> <span class="n">survival_probability</span> <span class="o">&lt;=</span> <span class="mi">0</span> <span class="ow">or</span> <span class="n">survival_probability</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
<a href="#__codelineno-0-127" id="__codelineno-0-127" name="__codelineno-0-127"></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">"Survival probability must be between 0 and 1"</span><span class="p">)</span>
<a href="#__codelineno-0-128" id="__codelineno-0-128" name="__codelineno-0-128"></a>
<a href="#__codelineno-0-129" id="__codelineno-0-129" name="__codelineno-0-129"></a>        <span class="k">return</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">survival_probability</span><span class="p">)</span> <span class="o">/</span> <span class="n">time_years</span>
<a href="#__codelineno-0-130" id="__codelineno-0-130" name="__codelineno-0-130"></a>
<a href="#__codelineno-0-131" id="__codelineno-0-131" name="__codelineno-0-131"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">calculate_survival_probability</span><span class="p">(</span>
<a href="#__codelineno-0-132" id="__codelineno-0-132" name="__codelineno-0-132"></a>        <span class="bp">self</span><span class="p">,</span>
<a href="#__codelineno-0-133" id="__codelineno-0-133" name="__codelineno-0-133"></a>        <span class="n">hazard_rate</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
<a href="#__codelineno-0-134" id="__codelineno-0-134" name="__codelineno-0-134"></a>        <span class="n">time_years</span><span class="p">:</span> <span class="nb">float</span>
<a href="#__codelineno-0-135" id="__codelineno-0-135" name="__codelineno-0-135"></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
<a href="#__codelineno-0-136" id="__codelineno-0-136" name="__codelineno-0-136"></a><span class="w">        </span><span class="sd">"""</span>
<a href="#__codelineno-0-137" id="__codelineno-0-137" name="__codelineno-0-137"></a><span class="sd">        Calculate survival probability from hazard rate</span>
<a href="#__codelineno-0-138" id="__codelineno-0-138" name="__codelineno-0-138"></a>
<a href="#__codelineno-0-139" id="__codelineno-0-139" name="__codelineno-0-139"></a><span class="sd">        Args:</span>
<a href="#__codelineno-0-140" id="__codelineno-0-140" name="__codelineno-0-140"></a><span class="sd">            hazard_rate: Constant intensity</span>
<a href="#__codelineno-0-141" id="__codelineno-0-141" name="__codelineno-0-141"></a><span class="sd">            time_years: Time period in years</span>
<a href="#__codelineno-0-142" id="__codelineno-0-142" name="__codelineno-0-142"></a>
<a href="#__codelineno-0-143" id="__codelineno-0-143" name="__codelineno-0-143"></a><span class="sd">        Returns:</span>
<a href="#__codelineno-0-144" id="__codelineno-0-144" name="__codelineno-0-144"></a><span class="sd">            Survival probability</span>
<a href="#__codelineno-0-145" id="__codelineno-0-145" name="__codelineno-0-145"></a><span class="sd">        """</span>
<a href="#__codelineno-0-146" id="__codelineno-0-146" name="__codelineno-0-146"></a>        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">hazard_rate</span> <span class="o">*</span> <span class="n">time_years</span><span class="p">)</span>
<a href="#__codelineno-0-147" id="__codelineno-0-147" name="__codelineno-0-147"></a>
<a href="#__codelineno-0-148" id="__codelineno-0-148" name="__codelineno-0-148"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">bootstrap_hazard_rate_from_spread</span><span class="p">(</span>
<a href="#__codelineno-0-149" id="__codelineno-0-149" name="__codelineno-0-149"></a>        <span class="bp">self</span><span class="p">,</span>
<a href="#__codelineno-0-150" id="__codelineno-0-150" name="__codelineno-0-150"></a>        <span class="n">discount_rate</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.05</span>
<a href="#__codelineno-0-151" id="__codelineno-0-151" name="__codelineno-0-151"></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
<a href="#__codelineno-0-152" id="__codelineno-0-152" name="__codelineno-0-152"></a><span class="w">        </span><span class="sd">"""</span>
<a href="#__codelineno-0-153" id="__codelineno-0-153" name="__codelineno-0-153"></a><span class="sd">        Bootstrap hazard rate from CDS spread (simplified)</span>
<a href="#__codelineno-0-154" id="__codelineno-0-154" name="__codelineno-0-154"></a>
<a href="#__codelineno-0-155" id="__codelineno-0-155" name="__codelineno-0-155"></a><span class="sd">        Args:</span>
<a href="#__codelineno-0-156" id="__codelineno-0-156" name="__codelineno-0-156"></a><span class="sd">            discount_rate: Risk-free discount rate</span>
<a href="#__codelineno-0-157" id="__codelineno-0-157" name="__codelineno-0-157"></a>
<a href="#__codelineno-0-158" id="__codelineno-0-158" name="__codelineno-0-158"></a><span class="sd">        Returns:</span>
<a href="#__codelineno-0-159" id="__codelineno-0-159" name="__codelineno-0-159"></a><span class="sd">            Bootstrapped hazard rate</span>
<a href="#__codelineno-0-160" id="__codelineno-0-160" name="__codelineno-0-160"></a><span class="sd">        """</span>
<a href="#__codelineno-0-161" id="__codelineno-0-161" name="__codelineno-0-161"></a>        <span class="c1"># Simplified approximation: spread ‚âà hazard_rate * (1 - recovery_rate)</span>
<a href="#__codelineno-0-162" id="__codelineno-0-162" name="__codelineno-0-162"></a>        <span class="n">hazard_rate</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">spread</span> <span class="o">/</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">recovery_rate</span><span class="p">)</span>
<a href="#__codelineno-0-163" id="__codelineno-0-163" name="__codelineno-0-163"></a>        <span class="k">return</span> <span class="n">hazard_rate</span>
<a href="#__codelineno-0-164" id="__codelineno-0-164" name="__codelineno-0-164"></a>
<a href="#__codelineno-0-165" id="__codelineno-0-165" name="__codelineno-0-165"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">calculate_premium_leg_pv</span><span class="p">(</span>
<a href="#__codelineno-0-166" id="__codelineno-0-166" name="__codelineno-0-166"></a>        <span class="bp">self</span><span class="p">,</span>
<a href="#__codelineno-0-167" id="__codelineno-0-167" name="__codelineno-0-167"></a>        <span class="n">hazard_rate</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
<a href="#__codelineno-0-168" id="__codelineno-0-168" name="__codelineno-0-168"></a>        <span class="n">discount_rate</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
<a href="#__codelineno-0-169" id="__codelineno-0-169" name="__codelineno-0-169"></a>        <span class="n">valuation_date</span><span class="p">:</span> <span class="n">datetime</span> <span class="o">=</span> <span class="kc">None</span>
<a href="#__codelineno-0-170" id="__codelineno-0-170" name="__codelineno-0-170"></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">:</span>
<a href="#__codelineno-0-171" id="__codelineno-0-171" name="__codelineno-0-171"></a><span class="w">        </span><span class="sd">"""</span>
<a href="#__codelineno-0-172" id="__codelineno-0-172" name="__codelineno-0-172"></a><span class="sd">        Calculate present value of premium leg</span>
<a href="#__codelineno-0-173" id="__codelineno-0-173" name="__codelineno-0-173"></a>
<a href="#__codelineno-0-174" id="__codelineno-0-174" name="__codelineno-0-174"></a><span class="sd">        Args:</span>
<a href="#__codelineno-0-175" id="__codelineno-0-175" name="__codelineno-0-175"></a><span class="sd">            hazard_rate: Credit intensity</span>
<a href="#__codelineno-0-176" id="__codelineno-0-176" name="__codelineno-0-176"></a><span class="sd">            discount_rate: Risk-free rate for discounting</span>
<a href="#__codelineno-0-177" id="__codelineno-0-177" name="__codelineno-0-177"></a><span class="sd">            valuation_date: Valuation date</span>
<a href="#__codelineno-0-178" id="__codelineno-0-178" name="__codelineno-0-178"></a>
<a href="#__codelineno-0-179" id="__codelineno-0-179" name="__codelineno-0-179"></a><span class="sd">        Returns:</span>
<a href="#__codelineno-0-180" id="__codelineno-0-180" name="__codelineno-0-180"></a><span class="sd">            Tuple of (premium_leg_pv, premium_payments list)</span>
<a href="#__codelineno-0-181" id="__codelineno-0-181" name="__codelineno-0-181"></a><span class="sd">        """</span>
<a href="#__codelineno-0-182" id="__codelineno-0-182" name="__codelineno-0-182"></a>        <span class="k">if</span> <span class="n">valuation_date</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
<a href="#__codelineno-0-183" id="__codelineno-0-183" name="__codelineno-0-183"></a>            <span class="n">valuation_date</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">start_date</span>
<a href="#__codelineno-0-184" id="__codelineno-0-184" name="__codelineno-0-184"></a>
<a href="#__codelineno-0-185" id="__codelineno-0-185" name="__codelineno-0-185"></a>        <span class="n">schedule</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">generate_payment_schedule</span><span class="p">()</span>
<a href="#__codelineno-0-186" id="__codelineno-0-186" name="__codelineno-0-186"></a>        <span class="n">premium_payments</span> <span class="o">=</span> <span class="p">[]</span>
<a href="#__codelineno-0-187" id="__codelineno-0-187" name="__codelineno-0-187"></a>        <span class="n">pv</span> <span class="o">=</span> <span class="mf">0.0</span>
<a href="#__codelineno-0-188" id="__codelineno-0-188" name="__codelineno-0-188"></a>        <span class="n">prev_date</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">start_date</span>
<a href="#__codelineno-0-189" id="__codelineno-0-189" name="__codelineno-0-189"></a>
<a href="#__codelineno-0-190" id="__codelineno-0-190" name="__codelineno-0-190"></a>        <span class="k">for</span> <span class="n">payment_date</span> <span class="ow">in</span> <span class="n">schedule</span><span class="p">:</span>
<a href="#__codelineno-0-191" id="__codelineno-0-191" name="__codelineno-0-191"></a>            <span class="k">if</span> <span class="n">payment_date</span> <span class="o">&gt;</span> <span class="n">valuation_date</span><span class="p">:</span>
<a href="#__codelineno-0-192" id="__codelineno-0-192" name="__codelineno-0-192"></a>                <span class="c1"># Calculate period</span>
<a href="#__codelineno-0-193" id="__codelineno-0-193" name="__codelineno-0-193"></a>                <span class="n">period_days</span> <span class="o">=</span> <span class="p">(</span><span class="n">payment_date</span> <span class="o">-</span> <span class="n">prev_date</span><span class="p">)</span><span class="o">.</span><span class="n">days</span>
<a href="#__codelineno-0-194" id="__codelineno-0-194" name="__codelineno-0-194"></a>                <span class="n">time_to_payment</span> <span class="o">=</span> <span class="p">(</span><span class="n">payment_date</span> <span class="o">-</span> <span class="n">valuation_date</span><span class="p">)</span><span class="o">.</span><span class="n">days</span> <span class="o">/</span> <span class="mf">365.0</span>
<a href="#__codelineno-0-195" id="__codelineno-0-195" name="__codelineno-0-195"></a>
<a href="#__codelineno-0-196" id="__codelineno-0-196" name="__codelineno-0-196"></a>                <span class="c1"># Premium amount</span>
<a href="#__codelineno-0-197" id="__codelineno-0-197" name="__codelineno-0-197"></a>                <span class="n">premium</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">notional</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">spread</span> <span class="o">*</span> <span class="p">(</span><span class="n">period_days</span> <span class="o">/</span> <span class="mf">360.0</span><span class="p">)</span>
<a href="#__codelineno-0-198" id="__codelineno-0-198" name="__codelineno-0-198"></a>
<a href="#__codelineno-0-199" id="__codelineno-0-199" name="__codelineno-0-199"></a>                <span class="c1"># Survival probability to payment date</span>
<a href="#__codelineno-0-200" id="__codelineno-0-200" name="__codelineno-0-200"></a>                <span class="n">survival_prob</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">calculate_survival_probability</span><span class="p">(</span>
<a href="#__codelineno-0-201" id="__codelineno-0-201" name="__codelineno-0-201"></a>                    <span class="n">hazard_rate</span><span class="p">,</span> <span class="n">time_to_payment</span>
<a href="#__codelineno-0-202" id="__codelineno-0-202" name="__codelineno-0-202"></a>                <span class="p">)</span>
<a href="#__codelineno-0-203" id="__codelineno-0-203" name="__codelineno-0-203"></a>
<a href="#__codelineno-0-204" id="__codelineno-0-204" name="__codelineno-0-204"></a>                <span class="c1"># Discount factor</span>
<a href="#__codelineno-0-205" id="__codelineno-0-205" name="__codelineno-0-205"></a>                <span class="n">discount_factor</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">discount_rate</span> <span class="o">*</span> <span class="n">time_to_payment</span><span class="p">)</span>
<a href="#__codelineno-0-206" id="__codelineno-0-206" name="__codelineno-0-206"></a>
<a href="#__codelineno-0-207" id="__codelineno-0-207" name="__codelineno-0-207"></a>                <span class="c1"># PV of this payment</span>
<a href="#__codelineno-0-208" id="__codelineno-0-208" name="__codelineno-0-208"></a>                <span class="n">pv</span> <span class="o">+=</span> <span class="n">premium</span> <span class="o">*</span> <span class="n">survival_prob</span> <span class="o">*</span> <span class="n">discount_factor</span>
<a href="#__codelineno-0-209" id="__codelineno-0-209" name="__codelineno-0-209"></a>
<a href="#__codelineno-0-210" id="__codelineno-0-210" name="__codelineno-0-210"></a>                <span class="n">premium_payments</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">PremiumPayment</span><span class="p">(</span>
<a href="#__codelineno-0-211" id="__codelineno-0-211" name="__codelineno-0-211"></a>                    <span class="n">payment_date</span><span class="o">=</span><span class="n">payment_date</span><span class="p">,</span>
<a href="#__codelineno-0-212" id="__codelineno-0-212" name="__codelineno-0-212"></a>                    <span class="n">premium_amount</span><span class="o">=</span><span class="n">premium</span><span class="p">,</span>
<a href="#__codelineno-0-213" id="__codelineno-0-213" name="__codelineno-0-213"></a>                    <span class="n">accrued_days</span><span class="o">=</span><span class="n">period_days</span><span class="p">,</span>
<a href="#__codelineno-0-214" id="__codelineno-0-214" name="__codelineno-0-214"></a>                    <span class="n">survival_probability</span><span class="o">=</span><span class="n">survival_prob</span>
<a href="#__codelineno-0-215" id="__codelineno-0-215" name="__codelineno-0-215"></a>                <span class="p">))</span>
<a href="#__codelineno-0-216" id="__codelineno-0-216" name="__codelineno-0-216"></a>
<a href="#__codelineno-0-217" id="__codelineno-0-217" name="__codelineno-0-217"></a>            <span class="n">prev_date</span> <span class="o">=</span> <span class="n">payment_date</span>
<a href="#__codelineno-0-218" id="__codelineno-0-218" name="__codelineno-0-218"></a>
<a href="#__codelineno-0-219" id="__codelineno-0-219" name="__codelineno-0-219"></a>        <span class="k">return</span> <span class="n">pv</span><span class="p">,</span> <span class="n">premium_payments</span>
<a href="#__codelineno-0-220" id="__codelineno-0-220" name="__codelineno-0-220"></a>
<a href="#__codelineno-0-221" id="__codelineno-0-221" name="__codelineno-0-221"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">calculate_protection_leg_pv</span><span class="p">(</span>
<a href="#__codelineno-0-222" id="__codelineno-0-222" name="__codelineno-0-222"></a>        <span class="bp">self</span><span class="p">,</span>
<a href="#__codelineno-0-223" id="__codelineno-0-223" name="__codelineno-0-223"></a>        <span class="n">hazard_rate</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
<a href="#__codelineno-0-224" id="__codelineno-0-224" name="__codelineno-0-224"></a>        <span class="n">discount_rate</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
<a href="#__codelineno-0-225" id="__codelineno-0-225" name="__codelineno-0-225"></a>        <span class="n">valuation_date</span><span class="p">:</span> <span class="n">datetime</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a href="#__codelineno-0-226" id="__codelineno-0-226" name="__codelineno-0-226"></a>        <span class="n">num_steps</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">365</span>
<a href="#__codelineno-0-227" id="__codelineno-0-227" name="__codelineno-0-227"></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
<a href="#__codelineno-0-228" id="__codelineno-0-228" name="__codelineno-0-228"></a><span class="w">        </span><span class="sd">"""</span>
<a href="#__codelineno-0-229" id="__codelineno-0-229" name="__codelineno-0-229"></a><span class="sd">        Calculate present value of protection leg using numerical integration</span>
<a href="#__codelineno-0-230" id="__codelineno-0-230" name="__codelineno-0-230"></a>
<a href="#__codelineno-0-231" id="__codelineno-0-231" name="__codelineno-0-231"></a><span class="sd">        Args:</span>
<a href="#__codelineno-0-232" id="__codelineno-0-232" name="__codelineno-0-232"></a><span class="sd">            hazard_rate: Credit intensity</span>
<a href="#__codelineno-0-233" id="__codelineno-0-233" name="__codelineno-0-233"></a><span class="sd">            discount_rate: Risk-free rate</span>
<a href="#__codelineno-0-234" id="__codelineno-0-234" name="__codelineno-0-234"></a><span class="sd">            valuation_date: Valuation date</span>
<a href="#__codelineno-0-235" id="__codelineno-0-235" name="__codelineno-0-235"></a><span class="sd">            num_steps: Number of integration steps</span>
<a href="#__codelineno-0-236" id="__codelineno-0-236" name="__codelineno-0-236"></a>
<a href="#__codelineno-0-237" id="__codelineno-0-237" name="__codelineno-0-237"></a><span class="sd">        Returns:</span>
<a href="#__codelineno-0-238" id="__codelineno-0-238" name="__codelineno-0-238"></a><span class="sd">            Protection leg present value</span>
<a href="#__codelineno-0-239" id="__codelineno-0-239" name="__codelineno-0-239"></a><span class="sd">        """</span>
<a href="#__codelineno-0-240" id="__codelineno-0-240" name="__codelineno-0-240"></a>        <span class="k">if</span> <span class="n">valuation_date</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
<a href="#__codelineno-0-241" id="__codelineno-0-241" name="__codelineno-0-241"></a>            <span class="n">valuation_date</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">start_date</span>
<a href="#__codelineno-0-242" id="__codelineno-0-242" name="__codelineno-0-242"></a>
<a href="#__codelineno-0-243" id="__codelineno-0-243" name="__codelineno-0-243"></a>        <span class="n">T</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">maturity_date</span> <span class="o">-</span> <span class="n">valuation_date</span><span class="p">)</span><span class="o">.</span><span class="n">days</span> <span class="o">/</span> <span class="mf">365.0</span>
<a href="#__codelineno-0-244" id="__codelineno-0-244" name="__codelineno-0-244"></a>        <span class="k">if</span> <span class="n">T</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">:</span>
<a href="#__codelineno-0-245" id="__codelineno-0-245" name="__codelineno-0-245"></a>            <span class="k">return</span> <span class="mf">0.0</span>
<a href="#__codelineno-0-246" id="__codelineno-0-246" name="__codelineno-0-246"></a>
<a href="#__codelineno-0-247" id="__codelineno-0-247" name="__codelineno-0-247"></a>        <span class="n">dt</span> <span class="o">=</span> <span class="n">T</span> <span class="o">/</span> <span class="n">num_steps</span>
<a href="#__codelineno-0-248" id="__codelineno-0-248" name="__codelineno-0-248"></a>        <span class="n">protection_pv</span> <span class="o">=</span> <span class="mf">0.0</span>
<a href="#__codelineno-0-249" id="__codelineno-0-249" name="__codelineno-0-249"></a>
<a href="#__codelineno-0-250" id="__codelineno-0-250" name="__codelineno-0-250"></a>        <span class="c1"># Loss given default</span>
<a href="#__codelineno-0-251" id="__codelineno-0-251" name="__codelineno-0-251"></a>        <span class="n">lgd</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">recovery_rate</span>
<a href="#__codelineno-0-252" id="__codelineno-0-252" name="__codelineno-0-252"></a>
<a href="#__codelineno-0-253" id="__codelineno-0-253" name="__codelineno-0-253"></a>        <span class="c1"># Integrate over time: LGD * hazard_rate * survival(t) * discount(t) dt</span>
<a href="#__codelineno-0-254" id="__codelineno-0-254" name="__codelineno-0-254"></a>        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">num_steps</span><span class="p">):</span>
<a href="#__codelineno-0-255" id="__codelineno-0-255" name="__codelineno-0-255"></a>            <span class="n">t</span> <span class="o">=</span> <span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="mf">0.5</span><span class="p">)</span> <span class="o">*</span> <span class="n">dt</span>  <span class="c1"># Midpoint</span>
<a href="#__codelineno-0-256" id="__codelineno-0-256" name="__codelineno-0-256"></a>
<a href="#__codelineno-0-257" id="__codelineno-0-257" name="__codelineno-0-257"></a>            <span class="n">survival_prob</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">calculate_survival_probability</span><span class="p">(</span><span class="n">hazard_rate</span><span class="p">,</span> <span class="n">t</span><span class="p">)</span>
<a href="#__codelineno-0-258" id="__codelineno-0-258" name="__codelineno-0-258"></a>            <span class="n">discount_factor</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">discount_rate</span> <span class="o">*</span> <span class="n">t</span><span class="p">)</span>
<a href="#__codelineno-0-259" id="__codelineno-0-259" name="__codelineno-0-259"></a>
<a href="#__codelineno-0-260" id="__codelineno-0-260" name="__codelineno-0-260"></a>            <span class="c1"># Default probability density = hazard_rate * survival_prob</span>
<a href="#__codelineno-0-261" id="__codelineno-0-261" name="__codelineno-0-261"></a>            <span class="n">default_density</span> <span class="o">=</span> <span class="n">hazard_rate</span> <span class="o">*</span> <span class="n">survival_prob</span>
<a href="#__codelineno-0-262" id="__codelineno-0-262" name="__codelineno-0-262"></a>
<a href="#__codelineno-0-263" id="__codelineno-0-263" name="__codelineno-0-263"></a>            <span class="n">protection_pv</span> <span class="o">+=</span> <span class="n">lgd</span> <span class="o">*</span> <span class="n">default_density</span> <span class="o">*</span> <span class="n">discount_factor</span> <span class="o">*</span> <span class="n">dt</span>
<a href="#__codelineno-0-264" id="__codelineno-0-264" name="__codelineno-0-264"></a>
<a href="#__codelineno-0-265" id="__codelineno-0-265" name="__codelineno-0-265"></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">notional</span> <span class="o">*</span> <span class="n">protection_pv</span>
<a href="#__codelineno-0-266" id="__codelineno-0-266" name="__codelineno-0-266"></a>
<a href="#__codelineno-0-267" id="__codelineno-0-267" name="__codelineno-0-267"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">calculate_fair_spread</span><span class="p">(</span>
<a href="#__codelineno-0-268" id="__codelineno-0-268" name="__codelineno-0-268"></a>        <span class="bp">self</span><span class="p">,</span>
<a href="#__codelineno-0-269" id="__codelineno-0-269" name="__codelineno-0-269"></a>        <span class="n">hazard_rate</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
<a href="#__codelineno-0-270" id="__codelineno-0-270" name="__codelineno-0-270"></a>        <span class="n">discount_rate</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
<a href="#__codelineno-0-271" id="__codelineno-0-271" name="__codelineno-0-271"></a>        <span class="n">valuation_date</span><span class="p">:</span> <span class="n">datetime</span> <span class="o">=</span> <span class="kc">None</span>
<a href="#__codelineno-0-272" id="__codelineno-0-272" name="__codelineno-0-272"></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
<a href="#__codelineno-0-273" id="__codelineno-0-273" name="__codelineno-0-273"></a><span class="w">        </span><span class="sd">"""</span>
<a href="#__codelineno-0-274" id="__codelineno-0-274" name="__codelineno-0-274"></a><span class="sd">        Calculate fair CDS spread (market spread where PV = 0)</span>
<a href="#__codelineno-0-275" id="__codelineno-0-275" name="__codelineno-0-275"></a>
<a href="#__codelineno-0-276" id="__codelineno-0-276" name="__codelineno-0-276"></a><span class="sd">        Args:</span>
<a href="#__codelineno-0-277" id="__codelineno-0-277" name="__codelineno-0-277"></a><span class="sd">            hazard_rate: Credit intensity</span>
<a href="#__codelineno-0-278" id="__codelineno-0-278" name="__codelineno-0-278"></a><span class="sd">            discount_rate: Risk-free rate</span>
<a href="#__codelineno-0-279" id="__codelineno-0-279" name="__codelineno-0-279"></a><span class="sd">            valuation_date: Valuation date</span>
<a href="#__codelineno-0-280" id="__codelineno-0-280" name="__codelineno-0-280"></a>
<a href="#__codelineno-0-281" id="__codelineno-0-281" name="__codelineno-0-281"></a><span class="sd">        Returns:</span>
<a href="#__codelineno-0-282" id="__codelineno-0-282" name="__codelineno-0-282"></a><span class="sd">            Fair spread in basis points</span>
<a href="#__codelineno-0-283" id="__codelineno-0-283" name="__codelineno-0-283"></a><span class="sd">        """</span>
<a href="#__codelineno-0-284" id="__codelineno-0-284" name="__codelineno-0-284"></a>        <span class="k">if</span> <span class="n">valuation_date</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
<a href="#__codelineno-0-285" id="__codelineno-0-285" name="__codelineno-0-285"></a>            <span class="n">valuation_date</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">start_date</span>
<a href="#__codelineno-0-286" id="__codelineno-0-286" name="__codelineno-0-286"></a>
<a href="#__codelineno-0-287" id="__codelineno-0-287" name="__codelineno-0-287"></a>        <span class="c1"># Calculate protection leg PV</span>
<a href="#__codelineno-0-288" id="__codelineno-0-288" name="__codelineno-0-288"></a>        <span class="n">protection_pv</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">calculate_protection_leg_pv</span><span class="p">(</span>
<a href="#__codelineno-0-289" id="__codelineno-0-289" name="__codelineno-0-289"></a>            <span class="n">hazard_rate</span><span class="p">,</span> <span class="n">discount_rate</span><span class="p">,</span> <span class="n">valuation_date</span>
<a href="#__codelineno-0-290" id="__codelineno-0-290" name="__codelineno-0-290"></a>        <span class="p">)</span>
<a href="#__codelineno-0-291" id="__codelineno-0-291" name="__codelineno-0-291"></a>
<a href="#__codelineno-0-292" id="__codelineno-0-292" name="__codelineno-0-292"></a>        <span class="c1"># Calculate risky annuity (PV01 of premium leg)</span>
<a href="#__codelineno-0-293" id="__codelineno-0-293" name="__codelineno-0-293"></a>        <span class="n">schedule</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">generate_payment_schedule</span><span class="p">()</span>
<a href="#__codelineno-0-294" id="__codelineno-0-294" name="__codelineno-0-294"></a>        <span class="n">risky_annuity</span> <span class="o">=</span> <span class="mf">0.0</span>
<a href="#__codelineno-0-295" id="__codelineno-0-295" name="__codelineno-0-295"></a>        <span class="n">prev_date</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">start_date</span>
<a href="#__codelineno-0-296" id="__codelineno-0-296" name="__codelineno-0-296"></a>
<a href="#__codelineno-0-297" id="__codelineno-0-297" name="__codelineno-0-297"></a>        <span class="k">for</span> <span class="n">payment_date</span> <span class="ow">in</span> <span class="n">schedule</span><span class="p">:</span>
<a href="#__codelineno-0-298" id="__codelineno-0-298" name="__codelineno-0-298"></a>            <span class="k">if</span> <span class="n">payment_date</span> <span class="o">&gt;</span> <span class="n">valuation_date</span><span class="p">:</span>
<a href="#__codelineno-0-299" id="__codelineno-0-299" name="__codelineno-0-299"></a>                <span class="n">period_days</span> <span class="o">=</span> <span class="p">(</span><span class="n">payment_date</span> <span class="o">-</span> <span class="n">prev_date</span><span class="p">)</span><span class="o">.</span><span class="n">days</span>
<a href="#__codelineno-0-300" id="__codelineno-0-300" name="__codelineno-0-300"></a>                <span class="n">time_to_payment</span> <span class="o">=</span> <span class="p">(</span><span class="n">payment_date</span> <span class="o">-</span> <span class="n">valuation_date</span><span class="p">)</span><span class="o">.</span><span class="n">days</span> <span class="o">/</span> <span class="mf">365.0</span>
<a href="#__codelineno-0-301" id="__codelineno-0-301" name="__codelineno-0-301"></a>
<a href="#__codelineno-0-302" id="__codelineno-0-302" name="__codelineno-0-302"></a>                <span class="n">survival_prob</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">calculate_survival_probability</span><span class="p">(</span>
<a href="#__codelineno-0-303" id="__codelineno-0-303" name="__codelineno-0-303"></a>                    <span class="n">hazard_rate</span><span class="p">,</span> <span class="n">time_to_payment</span>
<a href="#__codelineno-0-304" id="__codelineno-0-304" name="__codelineno-0-304"></a>                <span class="p">)</span>
<a href="#__codelineno-0-305" id="__codelineno-0-305" name="__codelineno-0-305"></a>                <span class="n">discount_factor</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">discount_rate</span> <span class="o">*</span> <span class="n">time_to_payment</span><span class="p">)</span>
<a href="#__codelineno-0-306" id="__codelineno-0-306" name="__codelineno-0-306"></a>
<a href="#__codelineno-0-307" id="__codelineno-0-307" name="__codelineno-0-307"></a>                <span class="n">risky_annuity</span> <span class="o">+=</span> <span class="p">(</span><span class="n">period_days</span> <span class="o">/</span> <span class="mf">360.0</span><span class="p">)</span> <span class="o">*</span> <span class="n">survival_prob</span> <span class="o">*</span> <span class="n">discount_factor</span>
<a href="#__codelineno-0-308" id="__codelineno-0-308" name="__codelineno-0-308"></a>
<a href="#__codelineno-0-309" id="__codelineno-0-309" name="__codelineno-0-309"></a>            <span class="n">prev_date</span> <span class="o">=</span> <span class="n">payment_date</span>
<a href="#__codelineno-0-310" id="__codelineno-0-310" name="__codelineno-0-310"></a>
<a href="#__codelineno-0-311" id="__codelineno-0-311" name="__codelineno-0-311"></a>        <span class="c1"># Fair spread = protection_pv / (notional * risky_annuity)</span>
<a href="#__codelineno-0-312" id="__codelineno-0-312" name="__codelineno-0-312"></a>        <span class="n">fair_spread</span> <span class="o">=</span> <span class="n">protection_pv</span> <span class="o">/</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">notional</span> <span class="o">*</span> <span class="n">risky_annuity</span><span class="p">)</span>
<a href="#__codelineno-0-313" id="__codelineno-0-313" name="__codelineno-0-313"></a>
<a href="#__codelineno-0-314" id="__codelineno-0-314" name="__codelineno-0-314"></a>        <span class="k">return</span> <span class="n">fair_spread</span> <span class="o">*</span> <span class="mi">10000</span>  <span class="c1"># Convert to basis points</span>
<a href="#__codelineno-0-315" id="__codelineno-0-315" name="__codelineno-0-315"></a>
<a href="#__codelineno-0-316" id="__codelineno-0-316" name="__codelineno-0-316"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">calculate_npv</span><span class="p">(</span>
<a href="#__codelineno-0-317" id="__codelineno-0-317" name="__codelineno-0-317"></a>        <span class="bp">self</span><span class="p">,</span>
<a href="#__codelineno-0-318" id="__codelineno-0-318" name="__codelineno-0-318"></a>        <span class="n">market_spread</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>  <span class="c1"># Current market spread in bps</span>
<a href="#__codelineno-0-319" id="__codelineno-0-319" name="__codelineno-0-319"></a>        <span class="n">discount_rate</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
<a href="#__codelineno-0-320" id="__codelineno-0-320" name="__codelineno-0-320"></a>        <span class="n">valuation_date</span><span class="p">:</span> <span class="n">datetime</span> <span class="o">=</span> <span class="kc">None</span>
<a href="#__codelineno-0-321" id="__codelineno-0-321" name="__codelineno-0-321"></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
<a href="#__codelineno-0-322" id="__codelineno-0-322" name="__codelineno-0-322"></a><span class="w">        </span><span class="sd">"""</span>
<a href="#__codelineno-0-323" id="__codelineno-0-323" name="__codelineno-0-323"></a><span class="sd">        Calculate mark-to-market value of CDS</span>
<a href="#__codelineno-0-324" id="__codelineno-0-324" name="__codelineno-0-324"></a>
<a href="#__codelineno-0-325" id="__codelineno-0-325" name="__codelineno-0-325"></a><span class="sd">        Args:</span>
<a href="#__codelineno-0-326" id="__codelineno-0-326" name="__codelineno-0-326"></a><span class="sd">            market_spread: Current market CDS spread (bps)</span>
<a href="#__codelineno-0-327" id="__codelineno-0-327" name="__codelineno-0-327"></a><span class="sd">            discount_rate: Risk-free rate</span>
<a href="#__codelineno-0-328" id="__codelineno-0-328" name="__codelineno-0-328"></a><span class="sd">            valuation_date: Valuation date</span>
<a href="#__codelineno-0-329" id="__codelineno-0-329" name="__codelineno-0-329"></a>
<a href="#__codelineno-0-330" id="__codelineno-0-330" name="__codelineno-0-330"></a><span class="sd">        Returns:</span>
<a href="#__codelineno-0-331" id="__codelineno-0-331" name="__codelineno-0-331"></a><span class="sd">            NPV of CDS (positive = gain for protection buyer)</span>
<a href="#__codelineno-0-332" id="__codelineno-0-332" name="__codelineno-0-332"></a><span class="sd">        """</span>
<a href="#__codelineno-0-333" id="__codelineno-0-333" name="__codelineno-0-333"></a>        <span class="k">if</span> <span class="n">valuation_date</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
<a href="#__codelineno-0-334" id="__codelineno-0-334" name="__codelineno-0-334"></a>            <span class="n">valuation_date</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">start_date</span>
<a href="#__codelineno-0-335" id="__codelineno-0-335" name="__codelineno-0-335"></a>
<a href="#__codelineno-0-336" id="__codelineno-0-336" name="__codelineno-0-336"></a>        <span class="c1"># Bootstrap hazard rate from market spread</span>
<a href="#__codelineno-0-337" id="__codelineno-0-337" name="__codelineno-0-337"></a>        <span class="n">market_spread_decimal</span> <span class="o">=</span> <span class="n">market_spread</span> <span class="o">/</span> <span class="mf">10000.0</span>
<a href="#__codelineno-0-338" id="__codelineno-0-338" name="__codelineno-0-338"></a>        <span class="n">market_hazard_rate</span> <span class="o">=</span> <span class="n">market_spread_decimal</span> <span class="o">/</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">recovery_rate</span><span class="p">)</span>
<a href="#__codelineno-0-339" id="__codelineno-0-339" name="__codelineno-0-339"></a>
<a href="#__codelineno-0-340" id="__codelineno-0-340" name="__codelineno-0-340"></a>        <span class="c1"># Calculate protection leg PV</span>
<a href="#__codelineno-0-341" id="__codelineno-0-341" name="__codelineno-0-341"></a>        <span class="n">protection_pv</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">calculate_protection_leg_pv</span><span class="p">(</span>
<a href="#__codelineno-0-342" id="__codelineno-0-342" name="__codelineno-0-342"></a>            <span class="n">market_hazard_rate</span><span class="p">,</span> <span class="n">discount_rate</span><span class="p">,</span> <span class="n">valuation_date</span>
<a href="#__codelineno-0-343" id="__codelineno-0-343" name="__codelineno-0-343"></a>        <span class="p">)</span>
<a href="#__codelineno-0-344" id="__codelineno-0-344" name="__codelineno-0-344"></a>
<a href="#__codelineno-0-345" id="__codelineno-0-345" name="__codelineno-0-345"></a>        <span class="c1"># Calculate premium leg PV at contract spread</span>
<a href="#__codelineno-0-346" id="__codelineno-0-346" name="__codelineno-0-346"></a>        <span class="n">premium_pv</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">calculate_premium_leg_pv</span><span class="p">(</span>
<a href="#__codelineno-0-347" id="__codelineno-0-347" name="__codelineno-0-347"></a>            <span class="n">market_hazard_rate</span><span class="p">,</span> <span class="n">discount_rate</span><span class="p">,</span> <span class="n">valuation_date</span>
<a href="#__codelineno-0-348" id="__codelineno-0-348" name="__codelineno-0-348"></a>        <span class="p">)</span>
<a href="#__codelineno-0-349" id="__codelineno-0-349" name="__codelineno-0-349"></a>
<a href="#__codelineno-0-350" id="__codelineno-0-350" name="__codelineno-0-350"></a>        <span class="c1"># NPV from protection buyer perspective</span>
<a href="#__codelineno-0-351" id="__codelineno-0-351" name="__codelineno-0-351"></a>        <span class="n">npv</span> <span class="o">=</span> <span class="n">protection_pv</span> <span class="o">-</span> <span class="n">premium_pv</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">upfront_fee</span>
<a href="#__codelineno-0-352" id="__codelineno-0-352" name="__codelineno-0-352"></a>
<a href="#__codelineno-0-353" id="__codelineno-0-353" name="__codelineno-0-353"></a>        <span class="c1"># Flip sign if protection seller</span>
<a href="#__codelineno-0-354" id="__codelineno-0-354" name="__codelineno-0-354"></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">position</span> <span class="o">==</span> <span class="s2">"seller"</span><span class="p">:</span>
<a href="#__codelineno-0-355" id="__codelineno-0-355" name="__codelineno-0-355"></a>            <span class="n">npv</span> <span class="o">=</span> <span class="o">-</span><span class="n">npv</span>
<a href="#__codelineno-0-356" id="__codelineno-0-356" name="__codelineno-0-356"></a>
<a href="#__codelineno-0-357" id="__codelineno-0-357" name="__codelineno-0-357"></a>        <span class="k">return</span> <span class="n">npv</span>
<a href="#__codelineno-0-358" id="__codelineno-0-358" name="__codelineno-0-358"></a>
<a href="#__codelineno-0-359" id="__codelineno-0-359" name="__codelineno-0-359"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">calculate_dv01</span><span class="p">(</span>
<a href="#__codelineno-0-360" id="__codelineno-0-360" name="__codelineno-0-360"></a>        <span class="bp">self</span><span class="p">,</span>
<a href="#__codelineno-0-361" id="__codelineno-0-361" name="__codelineno-0-361"></a>        <span class="n">market_spread</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
<a href="#__codelineno-0-362" id="__codelineno-0-362" name="__codelineno-0-362"></a>        <span class="n">discount_rate</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
<a href="#__codelineno-0-363" id="__codelineno-0-363" name="__codelineno-0-363"></a>        <span class="n">valuation_date</span><span class="p">:</span> <span class="n">datetime</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a href="#__codelineno-0-364" id="__codelineno-0-364" name="__codelineno-0-364"></a>        <span class="n">bump_size</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">1.0</span>  <span class="c1"># 1 basis point</span>
<a href="#__codelineno-0-365" id="__codelineno-0-365" name="__codelineno-0-365"></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
<a href="#__codelineno-0-366" id="__codelineno-0-366" name="__codelineno-0-366"></a><span class="w">        </span><span class="sd">"""</span>
<a href="#__codelineno-0-367" id="__codelineno-0-367" name="__codelineno-0-367"></a><span class="sd">        Calculate DV01 (dollar value of 1 basis point)</span>
<a href="#__codelineno-0-368" id="__codelineno-0-368" name="__codelineno-0-368"></a>
<a href="#__codelineno-0-369" id="__codelineno-0-369" name="__codelineno-0-369"></a><span class="sd">        Args:</span>
<a href="#__codelineno-0-370" id="__codelineno-0-370" name="__codelineno-0-370"></a><span class="sd">            market_spread: Current market spread (bps)</span>
<a href="#__codelineno-0-371" id="__codelineno-0-371" name="__codelineno-0-371"></a><span class="sd">            discount_rate: Risk-free rate</span>
<a href="#__codelineno-0-372" id="__codelineno-0-372" name="__codelineno-0-372"></a><span class="sd">            valuation_date: Valuation date</span>
<a href="#__codelineno-0-373" id="__codelineno-0-373" name="__codelineno-0-373"></a><span class="sd">            bump_size: Spread bump in bps</span>
<a href="#__codelineno-0-374" id="__codelineno-0-374" name="__codelineno-0-374"></a>
<a href="#__codelineno-0-375" id="__codelineno-0-375" name="__codelineno-0-375"></a><span class="sd">        Returns:</span>
<a href="#__codelineno-0-376" id="__codelineno-0-376" name="__codelineno-0-376"></a><span class="sd">            Change in value for 1bp spread widening</span>
<a href="#__codelineno-0-377" id="__codelineno-0-377" name="__codelineno-0-377"></a><span class="sd">        """</span>
<a href="#__codelineno-0-378" id="__codelineno-0-378" name="__codelineno-0-378"></a>        <span class="n">base_npv</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">calculate_npv</span><span class="p">(</span><span class="n">market_spread</span><span class="p">,</span> <span class="n">discount_rate</span><span class="p">,</span> <span class="n">valuation_date</span><span class="p">)</span>
<a href="#__codelineno-0-379" id="__codelineno-0-379" name="__codelineno-0-379"></a>        <span class="n">bumped_npv</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">calculate_npv</span><span class="p">(</span>
<a href="#__codelineno-0-380" id="__codelineno-0-380" name="__codelineno-0-380"></a>            <span class="n">market_spread</span> <span class="o">+</span> <span class="n">bump_size</span><span class="p">,</span> <span class="n">discount_rate</span><span class="p">,</span> <span class="n">valuation_date</span>
<a href="#__codelineno-0-381" id="__codelineno-0-381" name="__codelineno-0-381"></a>        <span class="p">)</span>
<a href="#__codelineno-0-382" id="__codelineno-0-382" name="__codelineno-0-382"></a>
<a href="#__codelineno-0-383" id="__codelineno-0-383" name="__codelineno-0-383"></a>        <span class="k">return</span> <span class="p">(</span><span class="n">bumped_npv</span> <span class="o">-</span> <span class="n">base_npv</span><span class="p">)</span> <span class="o">/</span> <span class="n">bump_size</span>
<a href="#__codelineno-0-384" id="__codelineno-0-384" name="__codelineno-0-384"></a>
<a href="#__codelineno-0-385" id="__codelineno-0-385" name="__codelineno-0-385"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">calculate_credit_spread_01</span><span class="p">(</span>
<a href="#__codelineno-0-386" id="__codelineno-0-386" name="__codelineno-0-386"></a>        <span class="bp">self</span><span class="p">,</span>
<a href="#__codelineno-0-387" id="__codelineno-0-387" name="__codelineno-0-387"></a>        <span class="n">hazard_rate</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
<a href="#__codelineno-0-388" id="__codelineno-0-388" name="__codelineno-0-388"></a>        <span class="n">discount_rate</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
<a href="#__codelineno-0-389" id="__codelineno-0-389" name="__codelineno-0-389"></a>        <span class="n">valuation_date</span><span class="p">:</span> <span class="n">datetime</span> <span class="o">=</span> <span class="kc">None</span>
<a href="#__codelineno-0-390" id="__codelineno-0-390" name="__codelineno-0-390"></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
<a href="#__codelineno-0-391" id="__codelineno-0-391" name="__codelineno-0-391"></a><span class="w">        </span><span class="sd">"""</span>
<a href="#__codelineno-0-392" id="__codelineno-0-392" name="__codelineno-0-392"></a><span class="sd">        Calculate CS01 (sensitivity to 1bp change in credit spread)</span>
<a href="#__codelineno-0-393" id="__codelineno-0-393" name="__codelineno-0-393"></a>
<a href="#__codelineno-0-394" id="__codelineno-0-394" name="__codelineno-0-394"></a><span class="sd">        Returns:</span>
<a href="#__codelineno-0-395" id="__codelineno-0-395" name="__codelineno-0-395"></a><span class="sd">            CS01 value</span>
<a href="#__codelineno-0-396" id="__codelineno-0-396" name="__codelineno-0-396"></a><span class="sd">        """</span>
<a href="#__codelineno-0-397" id="__codelineno-0-397" name="__codelineno-0-397"></a>        <span class="n">fair_spread</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">calculate_fair_spread</span><span class="p">(</span>
<a href="#__codelineno-0-398" id="__codelineno-0-398" name="__codelineno-0-398"></a>            <span class="n">hazard_rate</span><span class="p">,</span> <span class="n">discount_rate</span><span class="p">,</span> <span class="n">valuation_date</span>
<a href="#__codelineno-0-399" id="__codelineno-0-399" name="__codelineno-0-399"></a>        <span class="p">)</span>
<a href="#__codelineno-0-400" id="__codelineno-0-400" name="__codelineno-0-400"></a>
<a href="#__codelineno-0-401" id="__codelineno-0-401" name="__codelineno-0-401"></a>        <span class="c1"># Bump hazard rate</span>
<a href="#__codelineno-0-402" id="__codelineno-0-402" name="__codelineno-0-402"></a>        <span class="n">bumped_hazard</span> <span class="o">=</span> <span class="p">(</span><span class="n">fair_spread</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">/</span> <span class="mf">10000.0</span> <span class="o">/</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">recovery_rate</span><span class="p">)</span>
<a href="#__codelineno-0-403" id="__codelineno-0-403" name="__codelineno-0-403"></a>
<a href="#__codelineno-0-404" id="__codelineno-0-404" name="__codelineno-0-404"></a>        <span class="n">bumped_spread</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">calculate_fair_spread</span><span class="p">(</span>
<a href="#__codelineno-0-405" id="__codelineno-0-405" name="__codelineno-0-405"></a>            <span class="n">bumped_hazard</span><span class="p">,</span> <span class="n">discount_rate</span><span class="p">,</span> <span class="n">valuation_date</span>
<a href="#__codelineno-0-406" id="__codelineno-0-406" name="__codelineno-0-406"></a>        <span class="p">)</span>
<a href="#__codelineno-0-407" id="__codelineno-0-407" name="__codelineno-0-407"></a>
<a href="#__codelineno-0-408" id="__codelineno-0-408" name="__codelineno-0-408"></a>        <span class="k">return</span> <span class="nb">abs</span><span class="p">(</span><span class="n">bumped_spread</span> <span class="o">-</span> <span class="n">fair_spread</span><span class="p">)</span>
<a href="#__codelineno-0-409" id="__codelineno-0-409" name="__codelineno-0-409"></a>
<a href="#__codelineno-0-410" id="__codelineno-0-410" name="__codelineno-0-410"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">get_summary</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
<a href="#__codelineno-0-411" id="__codelineno-0-411" name="__codelineno-0-411"></a><span class="w">        </span><span class="sd">"""Get CDS summary information"""</span>
<a href="#__codelineno-0-412" id="__codelineno-0-412" name="__codelineno-0-412"></a>        <span class="n">tenor_years</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">maturity_date</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">start_date</span><span class="p">)</span><span class="o">.</span><span class="n">days</span> <span class="o">/</span> <span class="mf">365.0</span>
<a href="#__codelineno-0-413" id="__codelineno-0-413" name="__codelineno-0-413"></a>
<a href="#__codelineno-0-414" id="__codelineno-0-414" name="__codelineno-0-414"></a>        <span class="k">return</span> <span class="p">{</span>
<a href="#__codelineno-0-415" id="__codelineno-0-415" name="__codelineno-0-415"></a>            <span class="s1">'instrument_type'</span><span class="p">:</span> <span class="s1">'Credit Default Swap'</span><span class="p">,</span>
<a href="#__codelineno-0-416" id="__codelineno-0-416" name="__codelineno-0-416"></a>            <span class="s1">'notional'</span><span class="p">:</span> <span class="sa">f</span><span class="s2">"$</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">notional</span><span class="si">:</span><span class="s2">,.0f</span><span class="si">}</span><span class="s2">"</span><span class="p">,</span>
<a href="#__codelineno-0-417" id="__codelineno-0-417" name="__codelineno-0-417"></a>            <span class="s1">'spread'</span><span class="p">:</span> <span class="sa">f</span><span class="s2">"</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">spread</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mi">10000</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2"> bps"</span><span class="p">,</span>
<a href="#__codelineno-0-418" id="__codelineno-0-418" name="__codelineno-0-418"></a>            <span class="s1">'recovery_rate'</span><span class="p">:</span> <span class="sa">f</span><span class="s2">"</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">recovery_rate</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mi">100</span><span class="si">:</span><span class="s2">.1f</span><span class="si">}</span><span class="s2">%"</span><span class="p">,</span>
<a href="#__codelineno-0-419" id="__codelineno-0-419" name="__codelineno-0-419"></a>            <span class="s1">'start_date'</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">start_date</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s1">'%Y-%m-</span><span class="si">%d</span><span class="s1">'</span><span class="p">),</span>
<a href="#__codelineno-0-420" id="__codelineno-0-420" name="__codelineno-0-420"></a>            <span class="s1">'maturity'</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">maturity_date</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s1">'%Y-%m-</span><span class="si">%d</span><span class="s1">'</span><span class="p">),</span>
<a href="#__codelineno-0-421" id="__codelineno-0-421" name="__codelineno-0-421"></a>            <span class="s1">'tenor'</span><span class="p">:</span> <span class="sa">f</span><span class="s2">"</span><span class="si">{</span><span class="n">tenor_years</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2"> years"</span><span class="p">,</span>
<a href="#__codelineno-0-422" id="__codelineno-0-422" name="__codelineno-0-422"></a>            <span class="s1">'payment_frequency'</span><span class="p">:</span> <span class="sa">f</span><span class="s2">"</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">payment_frequency</span><span class="si">}</span><span class="s2">x per year"</span><span class="p">,</span>
<a href="#__codelineno-0-423" id="__codelineno-0-423" name="__codelineno-0-423"></a>            <span class="s1">'position'</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">position</span><span class="o">.</span><span class="n">capitalize</span><span class="p">(),</span>
<a href="#__codelineno-0-424" id="__codelineno-0-424" name="__codelineno-0-424"></a>            <span class="s1">'upfront_fee'</span><span class="p">:</span> <span class="sa">f</span><span class="s2">"$</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">upfront_fee</span><span class="si">:</span><span class="s2">,.2f</span><span class="si">}</span><span class="s2">"</span>
<a href="#__codelineno-0-425" id="__codelineno-0-425" name="__codelineno-0-425"></a>        <span class="p">}</span>
</code></pre></div>
<h2 id="usage-examples">üìä Usage Examples<a class="headerlink" href="#usage-examples" title="Permanent link">¬∂</a></h2>
<h3 id="example-1-create-a-5-year-cds">Example 1: Create a 5-Year CDS<a class="headerlink" href="#example-1-create-a-5-year-cds" title="Permanent link">¬∂</a></h3>
<div class="highlight"><pre><span></span><code><a href="#__codelineno-1-1" id="__codelineno-1-1" name="__codelineno-1-1"></a><span class="kn">from</span><span class="w"> </span><span class="nn">datetime</span><span class="w"> </span><span class="kn">import</span> <span class="n">datetime</span>
<a href="#__codelineno-1-2" id="__codelineno-1-2" name="__codelineno-1-2"></a>
<a href="#__codelineno-1-3" id="__codelineno-1-3" name="__codelineno-1-3"></a><span class="c1"># Create CDS on corporate reference entity</span>
<a href="#__codelineno-1-4" id="__codelineno-1-4" name="__codelineno-1-4"></a><span class="c1"># Notional: $10M, Spread: 250 bps, Recovery: 40%</span>
<a href="#__codelineno-1-5" id="__codelineno-1-5" name="__codelineno-1-5"></a><span class="n">cds</span> <span class="o">=</span> <span class="n">CreditDefaultSwap</span><span class="p">(</span>
<a href="#__codelineno-1-6" id="__codelineno-1-6" name="__codelineno-1-6"></a>    <span class="n">notional</span><span class="o">=</span><span class="mi">10_000_000</span><span class="p">,</span>
<a href="#__codelineno-1-7" id="__codelineno-1-7" name="__codelineno-1-7"></a>    <span class="n">spread</span><span class="o">=</span><span class="mi">250</span><span class="p">,</span>  <span class="c1"># 250 basis points = 2.5%</span>
<a href="#__codelineno-1-8" id="__codelineno-1-8" name="__codelineno-1-8"></a>    <span class="n">recovery_rate</span><span class="o">=</span><span class="mf">0.40</span><span class="p">,</span>
<a href="#__codelineno-1-9" id="__codelineno-1-9" name="__codelineno-1-9"></a>    <span class="n">start_date</span><span class="o">=</span><span class="n">datetime</span><span class="p">(</span><span class="mi">2025</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">20</span><span class="p">),</span>
<a href="#__codelineno-1-10" id="__codelineno-1-10" name="__codelineno-1-10"></a>    <span class="n">maturity_date</span><span class="o">=</span><span class="n">datetime</span><span class="p">(</span><span class="mi">2030</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">20</span><span class="p">),</span>
<a href="#__codelineno-1-11" id="__codelineno-1-11" name="__codelineno-1-11"></a>    <span class="n">payment_frequency</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span>  <span class="c1"># Quarterly</span>
<a href="#__codelineno-1-12" id="__codelineno-1-12" name="__codelineno-1-12"></a>    <span class="n">upfront_fee</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span>
<a href="#__codelineno-1-13" id="__codelineno-1-13" name="__codelineno-1-13"></a>    <span class="n">position</span><span class="o">=</span><span class="s2">"buyer"</span>  <span class="c1"># Buying protection</span>
<a href="#__codelineno-1-14" id="__codelineno-1-14" name="__codelineno-1-14"></a><span class="p">)</span>
<a href="#__codelineno-1-15" id="__codelineno-1-15" name="__codelineno-1-15"></a>
<a href="#__codelineno-1-16" id="__codelineno-1-16" name="__codelineno-1-16"></a><span class="c1"># Get summary</span>
<a href="#__codelineno-1-17" id="__codelineno-1-17" name="__codelineno-1-17"></a><span class="nb">print</span><span class="p">(</span><span class="s2">"CDS Summary:"</span><span class="p">)</span>
<a href="#__codelineno-1-18" id="__codelineno-1-18" name="__codelineno-1-18"></a><span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">cds</span><span class="o">.</span><span class="n">get_summary</span><span class="p">()</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
<a href="#__codelineno-1-19" id="__codelineno-1-19" name="__codelineno-1-19"></a>    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"  </span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">value</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
</code></pre></div>
<p><strong>Output:</strong>
<div class="highlight"><pre><span></span><code><a href="#__codelineno-2-1" id="__codelineno-2-1" name="__codelineno-2-1"></a>CDS Summary:
<a href="#__codelineno-2-2" id="__codelineno-2-2" name="__codelineno-2-2"></a>  instrument_type: Credit Default Swap
<a href="#__codelineno-2-3" id="__codelineno-2-3" name="__codelineno-2-3"></a>  notional: $10,000,000
<a href="#__codelineno-2-4" id="__codelineno-2-4" name="__codelineno-2-4"></a>  spread: 250.00 bps
<a href="#__codelineno-2-5" id="__codelineno-2-5" name="__codelineno-2-5"></a>  recovery_rate: 40.0%
<a href="#__codelineno-2-6" id="__codelineno-2-6" name="__codelineno-2-6"></a>  start_date: 2025-01-20
<a href="#__codelineno-2-7" id="__codelineno-2-7" name="__codelineno-2-7"></a>  maturity: 2030-01-20
<a href="#__codelineno-2-8" id="__codelineno-2-8" name="__codelineno-2-8"></a>  tenor: 5.00 years
<a href="#__codelineno-2-9" id="__codelineno-2-9" name="__codelineno-2-9"></a>  payment_frequency: 4x per year
<a href="#__codelineno-2-10" id="__codelineno-2-10" name="__codelineno-2-10"></a>  position: Buyer
<a href="#__codelineno-2-11" id="__codelineno-2-11" name="__codelineno-2-11"></a>  upfront_fee: $0.00
</code></pre></div></p>
<h3 id="example-2-calculate-fair-spread">Example 2: Calculate Fair Spread<a class="headerlink" href="#example-2-calculate-fair-spread" title="Permanent link">¬∂</a></h3>
<div class="highlight"><pre><span></span><code><a href="#__codelineno-3-1" id="__codelineno-3-1" name="__codelineno-3-1"></a><span class="c1"># Bootstrap hazard rate and calculate fair spread</span>
<a href="#__codelineno-3-2" id="__codelineno-3-2" name="__codelineno-3-2"></a><span class="n">hazard_rate</span> <span class="o">=</span> <span class="n">cds</span><span class="o">.</span><span class="n">bootstrap_hazard_rate_from_spread</span><span class="p">(</span><span class="n">discount_rate</span><span class="o">=</span><span class="mf">0.05</span><span class="p">)</span>
<a href="#__codelineno-3-3" id="__codelineno-3-3" name="__codelineno-3-3"></a><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"</span><span class="se">\n</span><span class="s2">Bootstrapped Hazard Rate: </span><span class="si">{</span><span class="n">hazard_rate</span><span class="o">*</span><span class="mi">100</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">% per year"</span><span class="p">)</span>
<a href="#__codelineno-3-4" id="__codelineno-3-4" name="__codelineno-3-4"></a>
<a href="#__codelineno-3-5" id="__codelineno-3-5" name="__codelineno-3-5"></a><span class="c1"># Calculate fair spread</span>
<a href="#__codelineno-3-6" id="__codelineno-3-6" name="__codelineno-3-6"></a><span class="n">fair_spread</span> <span class="o">=</span> <span class="n">cds</span><span class="o">.</span><span class="n">calculate_fair_spread</span><span class="p">(</span>
<a href="#__codelineno-3-7" id="__codelineno-3-7" name="__codelineno-3-7"></a>    <span class="n">hazard_rate</span><span class="o">=</span><span class="n">hazard_rate</span><span class="p">,</span>
<a href="#__codelineno-3-8" id="__codelineno-3-8" name="__codelineno-3-8"></a>    <span class="n">discount_rate</span><span class="o">=</span><span class="mf">0.05</span><span class="p">,</span>
<a href="#__codelineno-3-9" id="__codelineno-3-9" name="__codelineno-3-9"></a>    <span class="n">valuation_date</span><span class="o">=</span><span class="n">datetime</span><span class="p">(</span><span class="mi">2025</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">20</span><span class="p">)</span>
<a href="#__codelineno-3-10" id="__codelineno-3-10" name="__codelineno-3-10"></a><span class="p">)</span>
<a href="#__codelineno-3-11" id="__codelineno-3-11" name="__codelineno-3-11"></a>
<a href="#__codelineno-3-12" id="__codelineno-3-12" name="__codelineno-3-12"></a><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Fair CDS Spread: </span><span class="si">{</span><span class="n">fair_spread</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2"> bps"</span><span class="p">)</span>
</code></pre></div>
<h3 id="example-3-calculate-cds-valuation-mark-to-market">Example 3: Calculate CDS Valuation (Mark-to-Market)<a class="headerlink" href="#example-3-calculate-cds-valuation-mark-to-market" title="Permanent link">¬∂</a></h3>
<div class="highlight"><pre><span></span><code><a href="#__codelineno-4-1" id="__codelineno-4-1" name="__codelineno-4-1"></a><span class="c1"># Entered CDS at 250 bps, now market spread is 300 bps</span>
<a href="#__codelineno-4-2" id="__codelineno-4-2" name="__codelineno-4-2"></a><span class="c1"># (credit quality has deteriorated)</span>
<a href="#__codelineno-4-3" id="__codelineno-4-3" name="__codelineno-4-3"></a><span class="n">valuation_date</span> <span class="o">=</span> <span class="n">datetime</span><span class="p">(</span><span class="mi">2025</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">20</span><span class="p">)</span>
<a href="#__codelineno-4-4" id="__codelineno-4-4" name="__codelineno-4-4"></a>
<a href="#__codelineno-4-5" id="__codelineno-4-5" name="__codelineno-4-5"></a><span class="n">npv</span> <span class="o">=</span> <span class="n">cds</span><span class="o">.</span><span class="n">calculate_npv</span><span class="p">(</span>
<a href="#__codelineno-4-6" id="__codelineno-4-6" name="__codelineno-4-6"></a>    <span class="n">market_spread</span><span class="o">=</span><span class="mi">300</span><span class="p">,</span>  <span class="c1"># Current market spread</span>
<a href="#__codelineno-4-7" id="__codelineno-4-7" name="__codelineno-4-7"></a>    <span class="n">discount_rate</span><span class="o">=</span><span class="mf">0.05</span><span class="p">,</span>
<a href="#__codelineno-4-8" id="__codelineno-4-8" name="__codelineno-4-8"></a>    <span class="n">valuation_date</span><span class="o">=</span><span class="n">valuation_date</span>
<a href="#__codelineno-4-9" id="__codelineno-4-9" name="__codelineno-4-9"></a><span class="p">)</span>
<a href="#__codelineno-4-10" id="__codelineno-4-10" name="__codelineno-4-10"></a>
<a href="#__codelineno-4-11" id="__codelineno-4-11" name="__codelineno-4-11"></a><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"</span><span class="se">\n</span><span class="s2">CDS Mark-to-Market:"</span><span class="p">)</span>
<a href="#__codelineno-4-12" id="__codelineno-4-12" name="__codelineno-4-12"></a><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"  Contract Spread: 250 bps"</span><span class="p">)</span>
<a href="#__codelineno-4-13" id="__codelineno-4-13" name="__codelineno-4-13"></a><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"  Market Spread: 300 bps"</span><span class="p">)</span>
<a href="#__codelineno-4-14" id="__codelineno-4-14" name="__codelineno-4-14"></a><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"  NPV (Protection Buyer): $</span><span class="si">{</span><span class="n">npv</span><span class="si">:</span><span class="s2">,.2f</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
<a href="#__codelineno-4-15" id="__codelineno-4-15" name="__codelineno-4-15"></a>
<a href="#__codelineno-4-16" id="__codelineno-4-16" name="__codelineno-4-16"></a><span class="k">if</span> <span class="n">npv</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
<a href="#__codelineno-4-17" id="__codelineno-4-17" name="__codelineno-4-17"></a>    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"  Status: In-the-money (spreads widened, protection more valuable)"</span><span class="p">)</span>
<a href="#__codelineno-4-18" id="__codelineno-4-18" name="__codelineno-4-18"></a><span class="k">else</span><span class="p">:</span>
<a href="#__codelineno-4-19" id="__codelineno-4-19" name="__codelineno-4-19"></a>    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"  Status: Out-of-the-money"</span><span class="p">)</span>
</code></pre></div>
<h3 id="example-4-risk-metrics-dv01">Example 4: Risk Metrics (DV01)<a class="headerlink" href="#example-4-risk-metrics-dv01" title="Permanent link">¬∂</a></h3>
<div class="highlight"><pre><span></span><code><a href="#__codelineno-5-1" id="__codelineno-5-1" name="__codelineno-5-1"></a><span class="c1"># Calculate DV01 - sensitivity to 1bp spread change</span>
<a href="#__codelineno-5-2" id="__codelineno-5-2" name="__codelineno-5-2"></a><span class="n">dv01</span> <span class="o">=</span> <span class="n">cds</span><span class="o">.</span><span class="n">calculate_dv01</span><span class="p">(</span>
<a href="#__codelineno-5-3" id="__codelineno-5-3" name="__codelineno-5-3"></a>    <span class="n">market_spread</span><span class="o">=</span><span class="mi">250</span><span class="p">,</span>
<a href="#__codelineno-5-4" id="__codelineno-5-4" name="__codelineno-5-4"></a>    <span class="n">discount_rate</span><span class="o">=</span><span class="mf">0.05</span><span class="p">,</span>
<a href="#__codelineno-5-5" id="__codelineno-5-5" name="__codelineno-5-5"></a>    <span class="n">valuation_date</span><span class="o">=</span><span class="n">datetime</span><span class="p">(</span><span class="mi">2025</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">20</span><span class="p">)</span>
<a href="#__codelineno-5-6" id="__codelineno-5-6" name="__codelineno-5-6"></a><span class="p">)</span>
<a href="#__codelineno-5-7" id="__codelineno-5-7" name="__codelineno-5-7"></a>
<a href="#__codelineno-5-8" id="__codelineno-5-8" name="__codelineno-5-8"></a><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"</span><span class="se">\n</span><span class="s2">Risk Metrics:"</span><span class="p">)</span>
<a href="#__codelineno-5-9" id="__codelineno-5-9" name="__codelineno-5-9"></a><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"  DV01: $</span><span class="si">{</span><span class="n">dv01</span><span class="si">:</span><span class="s2">,.2f</span><span class="si">}</span><span class="s2"> per 1bp"</span><span class="p">)</span>
<a href="#__codelineno-5-10" id="__codelineno-5-10" name="__codelineno-5-10"></a><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"  10bp Spread Widening Impact: $</span><span class="si">{</span><span class="n">dv01</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mi">10</span><span class="si">:</span><span class="s2">,.2f</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
<a href="#__codelineno-5-11" id="__codelineno-5-11" name="__codelineno-5-11"></a><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"  50bp Spread Widening Impact: $</span><span class="si">{</span><span class="n">dv01</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mi">50</span><span class="si">:</span><span class="s2">,.2f</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
<a href="#__codelineno-5-12" id="__codelineno-5-12" name="__codelineno-5-12"></a>
<a href="#__codelineno-5-13" id="__codelineno-5-13" name="__codelineno-5-13"></a><span class="c1"># Calculate for different notionals</span>
<a href="#__codelineno-5-14" id="__codelineno-5-14" name="__codelineno-5-14"></a><span class="n">notionals</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1_000_000</span><span class="p">,</span> <span class="mi">5_000_000</span><span class="p">,</span> <span class="mi">10_000_000</span><span class="p">,</span> <span class="mi">50_000_000</span><span class="p">]</span>
<a href="#__codelineno-5-15" id="__codelineno-5-15" name="__codelineno-5-15"></a><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"</span><span class="se">\n</span><span class="si">{</span><span class="s1">'Notional'</span><span class="si">:</span><span class="s2">&lt;15</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="s1">'DV01'</span><span class="si">:</span><span class="s2">&lt;15</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="s1">'10bp Impact'</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
<a href="#__codelineno-5-16" id="__codelineno-5-16" name="__codelineno-5-16"></a><span class="nb">print</span><span class="p">(</span><span class="s2">"-"</span> <span class="o">*</span> <span class="mi">50</span><span class="p">)</span>
<a href="#__codelineno-5-17" id="__codelineno-5-17" name="__codelineno-5-17"></a><span class="k">for</span> <span class="n">notional</span> <span class="ow">in</span> <span class="n">notionals</span><span class="p">:</span>
<a href="#__codelineno-5-18" id="__codelineno-5-18" name="__codelineno-5-18"></a>    <span class="n">temp_cds</span> <span class="o">=</span> <span class="n">CreditDefaultSwap</span><span class="p">(</span>
<a href="#__codelineno-5-19" id="__codelineno-5-19" name="__codelineno-5-19"></a>        <span class="n">notional</span><span class="p">,</span> <span class="mi">250</span><span class="p">,</span> <span class="mf">0.40</span><span class="p">,</span>
<a href="#__codelineno-5-20" id="__codelineno-5-20" name="__codelineno-5-20"></a>        <span class="n">datetime</span><span class="p">(</span><span class="mi">2025</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">20</span><span class="p">),</span> <span class="n">datetime</span><span class="p">(</span><span class="mi">2030</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">20</span><span class="p">)</span>
<a href="#__codelineno-5-21" id="__codelineno-5-21" name="__codelineno-5-21"></a>    <span class="p">)</span>
<a href="#__codelineno-5-22" id="__codelineno-5-22" name="__codelineno-5-22"></a>    <span class="n">dv01_temp</span> <span class="o">=</span> <span class="n">temp_cds</span><span class="o">.</span><span class="n">calculate_dv01</span><span class="p">(</span><span class="mi">250</span><span class="p">,</span> <span class="mf">0.05</span><span class="p">,</span> <span class="n">datetime</span><span class="p">(</span><span class="mi">2025</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">20</span><span class="p">))</span>
<a href="#__codelineno-5-23" id="__codelineno-5-23" name="__codelineno-5-23"></a>    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"$</span><span class="si">{</span><span class="n">notional</span><span class="si">:</span><span class="s2">&gt;13,</span><span class="si">}</span><span class="s2"> $</span><span class="si">{</span><span class="n">dv01_temp</span><span class="si">:</span><span class="s2">&gt;13,.2f</span><span class="si">}</span><span class="s2"> $</span><span class="si">{</span><span class="n">dv01_temp</span><span class="o">*</span><span class="mi">10</span><span class="si">:</span><span class="s2">&gt;13,.2f</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
</code></pre></div>
<h3 id="example-5-premium-leg-cash-flows">Example 5: Premium Leg Cash Flows<a class="headerlink" href="#example-5-premium-leg-cash-flows" title="Permanent link">¬∂</a></h3>
<div class="highlight"><pre><span></span><code><a href="#__codelineno-6-1" id="__codelineno-6-1" name="__codelineno-6-1"></a><span class="c1"># Calculate premium payments</span>
<a href="#__codelineno-6-2" id="__codelineno-6-2" name="__codelineno-6-2"></a><span class="n">hazard_rate</span> <span class="o">=</span> <span class="mf">0.04</span>  <span class="c1"># 4% annual hazard rate</span>
<a href="#__codelineno-6-3" id="__codelineno-6-3" name="__codelineno-6-3"></a><span class="n">premium_pv</span><span class="p">,</span> <span class="n">payments</span> <span class="o">=</span> <span class="n">cds</span><span class="o">.</span><span class="n">calculate_premium_leg_pv</span><span class="p">(</span>
<a href="#__codelineno-6-4" id="__codelineno-6-4" name="__codelineno-6-4"></a>    <span class="n">hazard_rate</span><span class="o">=</span><span class="n">hazard_rate</span><span class="p">,</span>
<a href="#__codelineno-6-5" id="__codelineno-6-5" name="__codelineno-6-5"></a>    <span class="n">discount_rate</span><span class="o">=</span><span class="mf">0.05</span><span class="p">,</span>
<a href="#__codelineno-6-6" id="__codelineno-6-6" name="__codelineno-6-6"></a>    <span class="n">valuation_date</span><span class="o">=</span><span class="n">datetime</span><span class="p">(</span><span class="mi">2025</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">20</span><span class="p">)</span>
<a href="#__codelineno-6-7" id="__codelineno-6-7" name="__codelineno-6-7"></a><span class="p">)</span>
<a href="#__codelineno-6-8" id="__codelineno-6-8" name="__codelineno-6-8"></a>
<a href="#__codelineno-6-9" id="__codelineno-6-9" name="__codelineno-6-9"></a><span class="nb">print</span><span class="p">(</span><span class="s2">"</span><span class="se">\n</span><span class="s2">Premium Payment Schedule:"</span><span class="p">)</span>
<a href="#__codelineno-6-10" id="__codelineno-6-10" name="__codelineno-6-10"></a><span class="nb">print</span><span class="p">(</span><span class="s2">"-"</span> <span class="o">*</span> <span class="mi">80</span><span class="p">)</span>
<a href="#__codelineno-6-11" id="__codelineno-6-11" name="__codelineno-6-11"></a><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"</span><span class="si">{</span><span class="s1">'Date'</span><span class="si">:</span><span class="s2">&lt;12</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="s1">'Premium'</span><span class="si">:</span><span class="s2">&lt;15</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="s1">'Survival Prob'</span><span class="si">:</span><span class="s2">&lt;15</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="s1">'PV Contribution'</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
<a href="#__codelineno-6-12" id="__codelineno-6-12" name="__codelineno-6-12"></a><span class="nb">print</span><span class="p">(</span><span class="s2">"-"</span> <span class="o">*</span> <span class="mi">80</span><span class="p">)</span>
<a href="#__codelineno-6-13" id="__codelineno-6-13" name="__codelineno-6-13"></a>
<a href="#__codelineno-6-14" id="__codelineno-6-14" name="__codelineno-6-14"></a><span class="k">for</span> <span class="n">payment</span> <span class="ow">in</span> <span class="n">payments</span><span class="p">[:</span><span class="mi">8</span><span class="p">]:</span>  <span class="c1"># Show first 8 payments</span>
<a href="#__codelineno-6-15" id="__codelineno-6-15" name="__codelineno-6-15"></a>    <span class="n">time_years</span> <span class="o">=</span> <span class="p">(</span><span class="n">payment</span><span class="o">.</span><span class="n">payment_date</span> <span class="o">-</span> <span class="n">datetime</span><span class="p">(</span><span class="mi">2025</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">20</span><span class="p">))</span><span class="o">.</span><span class="n">days</span> <span class="o">/</span> <span class="mf">365.0</span>
<a href="#__codelineno-6-16" id="__codelineno-6-16" name="__codelineno-6-16"></a>    <span class="n">discount</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="mf">0.05</span> <span class="o">*</span> <span class="n">time_years</span><span class="p">)</span>
<a href="#__codelineno-6-17" id="__codelineno-6-17" name="__codelineno-6-17"></a>    <span class="n">pv_contrib</span> <span class="o">=</span> <span class="n">payment</span><span class="o">.</span><span class="n">premium_amount</span> <span class="o">*</span> <span class="n">payment</span><span class="o">.</span><span class="n">survival_probability</span> <span class="o">*</span> <span class="n">discount</span>
<a href="#__codelineno-6-18" id="__codelineno-6-18" name="__codelineno-6-18"></a>
<a href="#__codelineno-6-19" id="__codelineno-6-19" name="__codelineno-6-19"></a>    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"</span><span class="si">{</span><span class="n">payment</span><span class="o">.</span><span class="n">payment_date</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s1">'%Y-%m-</span><span class="si">%d</span><span class="s1">'</span><span class="p">)</span><span class="si">:</span><span class="s2">&lt;12</span><span class="si">}</span><span class="s2"> "</span>
<a href="#__codelineno-6-20" id="__codelineno-6-20" name="__codelineno-6-20"></a>          <span class="sa">f</span><span class="s2">"$</span><span class="si">{</span><span class="n">payment</span><span class="o">.</span><span class="n">premium_amount</span><span class="si">:</span><span class="s2">&gt;13,.2f</span><span class="si">}</span><span class="s2"> "</span>
<a href="#__codelineno-6-21" id="__codelineno-6-21" name="__codelineno-6-21"></a>          <span class="sa">f</span><span class="s2">"</span><span class="si">{</span><span class="n">payment</span><span class="o">.</span><span class="n">survival_probability</span><span class="si">:</span><span class="s2">&gt;13.6f</span><span class="si">}</span><span class="s2"> "</span>
<a href="#__codelineno-6-22" id="__codelineno-6-22" name="__codelineno-6-22"></a>          <span class="sa">f</span><span class="s2">"$</span><span class="si">{</span><span class="n">pv_contrib</span><span class="si">:</span><span class="s2">&gt;13,.2f</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
<a href="#__codelineno-6-23" id="__codelineno-6-23" name="__codelineno-6-23"></a>
<a href="#__codelineno-6-24" id="__codelineno-6-24" name="__codelineno-6-24"></a><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"</span><span class="se">\n</span><span class="s2">Total Premium Leg PV: $</span><span class="si">{</span><span class="n">premium_pv</span><span class="si">:</span><span class="s2">,.2f</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
</code></pre></div>
<h2 id="use-cases">üéØ Use Cases<a class="headerlink" href="#use-cases" title="Permanent link">¬∂</a></h2>
<h3 id="1-credit-hedging">1. Credit Hedging<a class="headerlink" href="#1-credit-hedging" title="Permanent link">¬∂</a></h3>
<div class="highlight"><pre><span></span><code><a href="#__codelineno-7-1" id="__codelineno-7-1" name="__codelineno-7-1"></a><span class="c1"># Bank hedges $50M corporate loan exposure</span>
<a href="#__codelineno-7-2" id="__codelineno-7-2" name="__codelineno-7-2"></a><span class="n">loan_notional</span> <span class="o">=</span> <span class="mi">50_000_000</span>
<a href="#__codelineno-7-3" id="__codelineno-7-3" name="__codelineno-7-3"></a><span class="n">loan_spread</span> <span class="o">=</span> <span class="mi">300</span>  <span class="c1"># bps over risk-free</span>
<a href="#__codelineno-7-4" id="__codelineno-7-4" name="__codelineno-7-4"></a>
<a href="#__codelineno-7-5" id="__codelineno-7-5" name="__codelineno-7-5"></a><span class="c1"># Buy CDS protection</span>
<a href="#__codelineno-7-6" id="__codelineno-7-6" name="__codelineno-7-6"></a><span class="n">hedge_cds</span> <span class="o">=</span> <span class="n">CreditDefaultSwap</span><span class="p">(</span>
<a href="#__codelineno-7-7" id="__codelineno-7-7" name="__codelineno-7-7"></a>    <span class="n">notional</span><span class="o">=</span><span class="n">loan_notional</span><span class="p">,</span>
<a href="#__codelineno-7-8" id="__codelineno-7-8" name="__codelineno-7-8"></a>    <span class="n">spread</span><span class="o">=</span><span class="mi">250</span><span class="p">,</span>  <span class="c1"># Pay 250 bps for protection</span>
<a href="#__codelineno-7-9" id="__codelineno-7-9" name="__codelineno-7-9"></a>    <span class="n">recovery_rate</span><span class="o">=</span><span class="mf">0.40</span><span class="p">,</span>
<a href="#__codelineno-7-10" id="__codelineno-7-10" name="__codelineno-7-10"></a>    <span class="n">start_date</span><span class="o">=</span><span class="n">datetime</span><span class="p">(</span><span class="mi">2025</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">20</span><span class="p">),</span>
<a href="#__codelineno-7-11" id="__codelineno-7-11" name="__codelineno-7-11"></a>    <span class="n">maturity_date</span><span class="o">=</span><span class="n">datetime</span><span class="p">(</span><span class="mi">2030</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">20</span><span class="p">),</span>
<a href="#__codelineno-7-12" id="__codelineno-7-12" name="__codelineno-7-12"></a>    <span class="n">position</span><span class="o">=</span><span class="s2">"buyer"</span>
<a href="#__codelineno-7-13" id="__codelineno-7-13" name="__codelineno-7-13"></a><span class="p">)</span>
<a href="#__codelineno-7-14" id="__codelineno-7-14" name="__codelineno-7-14"></a>
<a href="#__codelineno-7-15" id="__codelineno-7-15" name="__codelineno-7-15"></a><span class="nb">print</span><span class="p">(</span><span class="s2">"Credit Hedge Position:"</span><span class="p">)</span>
<a href="#__codelineno-7-16" id="__codelineno-7-16" name="__codelineno-7-16"></a><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"  Loan Exposure: $</span><span class="si">{</span><span class="n">loan_notional</span><span class="si">:</span><span class="s2">,.0f</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
<a href="#__codelineno-7-17" id="__codelineno-7-17" name="__codelineno-7-17"></a><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"  Loan Spread Earned: </span><span class="si">{</span><span class="n">loan_spread</span><span class="si">}</span><span class="s2"> bps"</span><span class="p">)</span>
<a href="#__codelineno-7-18" id="__codelineno-7-18" name="__codelineno-7-18"></a><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"  CDS Premium Paid: 250 bps"</span><span class="p">)</span>
<a href="#__codelineno-7-19" id="__codelineno-7-19" name="__codelineno-7-19"></a><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"  Net Spread: </span><span class="si">{</span><span class="n">loan_spread</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">250</span><span class="si">}</span><span class="s2"> bps"</span><span class="p">)</span>
<a href="#__codelineno-7-20" id="__codelineno-7-20" name="__codelineno-7-20"></a><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"  Annual Net Income: $</span><span class="si">{</span><span class="n">loan_notional</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="p">(</span><span class="n">loan_spread</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">250</span><span class="p">)</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="mi">10000</span><span class="si">:</span><span class="s2">,.2f</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
</code></pre></div>
<h3 id="2-credit-arbitrage">2. Credit Arbitrage<a class="headerlink" href="#2-credit-arbitrage" title="Permanent link">¬∂</a></h3>
<div class="highlight"><pre><span></span><code><a href="#__codelineno-8-1" id="__codelineno-8-1" name="__codelineno-8-1"></a><span class="c1"># Long/short credit arbitrage</span>
<a href="#__codelineno-8-2" id="__codelineno-8-2" name="__codelineno-8-2"></a><span class="c1"># Long protection on company A (250 bps)</span>
<a href="#__codelineno-8-3" id="__codelineno-8-3" name="__codelineno-8-3"></a><span class="c1"># Short protection on company B (300 bps)</span>
<a href="#__codelineno-8-4" id="__codelineno-8-4" name="__codelineno-8-4"></a>
<a href="#__codelineno-8-5" id="__codelineno-8-5" name="__codelineno-8-5"></a><span class="n">cds_long</span> <span class="o">=</span> <span class="n">CreditDefaultSwap</span><span class="p">(</span><span class="mi">10_000_000</span><span class="p">,</span> <span class="mi">250</span><span class="p">,</span> <span class="mf">0.40</span><span class="p">,</span>
<a href="#__codelineno-8-6" id="__codelineno-8-6" name="__codelineno-8-6"></a>                             <span class="n">datetime</span><span class="p">(</span><span class="mi">2025</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">20</span><span class="p">),</span> <span class="n">datetime</span><span class="p">(</span><span class="mi">2030</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">20</span><span class="p">),</span>
<a href="#__codelineno-8-7" id="__codelineno-8-7" name="__codelineno-8-7"></a>                             <span class="n">position</span><span class="o">=</span><span class="s2">"buyer"</span><span class="p">)</span>
<a href="#__codelineno-8-8" id="__codelineno-8-8" name="__codelineno-8-8"></a>
<a href="#__codelineno-8-9" id="__codelineno-8-9" name="__codelineno-8-9"></a><span class="n">cds_short</span> <span class="o">=</span> <span class="n">CreditDefaultSwap</span><span class="p">(</span><span class="mi">10_000_000</span><span class="p">,</span> <span class="mi">300</span><span class="p">,</span> <span class="mf">0.40</span><span class="p">,</span>
<a href="#__codelineno-8-10" id="__codelineno-8-10" name="__codelineno-8-10"></a>                              <span class="n">datetime</span><span class="p">(</span><span class="mi">2025</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">20</span><span class="p">),</span> <span class="n">datetime</span><span class="p">(</span><span class="mi">2030</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">20</span><span class="p">),</span>
<a href="#__codelineno-8-11" id="__codelineno-8-11" name="__codelineno-8-11"></a>                              <span class="n">position</span><span class="o">=</span><span class="s2">"seller"</span><span class="p">)</span>
<a href="#__codelineno-8-12" id="__codelineno-8-12" name="__codelineno-8-12"></a>
<a href="#__codelineno-8-13" id="__codelineno-8-13" name="__codelineno-8-13"></a><span class="c1"># Calculate combined P&amp;L if both spreads widen by 50 bps</span>
<a href="#__codelineno-8-14" id="__codelineno-8-14" name="__codelineno-8-14"></a><span class="n">npv_long</span> <span class="o">=</span> <span class="n">cds_long</span><span class="o">.</span><span class="n">calculate_npv</span><span class="p">(</span><span class="mi">300</span><span class="p">,</span> <span class="mf">0.05</span><span class="p">,</span> <span class="n">datetime</span><span class="p">(</span><span class="mi">2025</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">20</span><span class="p">))</span>
<a href="#__codelineno-8-15" id="__codelineno-8-15" name="__codelineno-8-15"></a><span class="n">npv_short</span> <span class="o">=</span> <span class="n">cds_short</span><span class="o">.</span><span class="n">calculate_npv</span><span class="p">(</span><span class="mi">350</span><span class="p">,</span> <span class="mf">0.05</span><span class="p">,</span> <span class="n">datetime</span><span class="p">(</span><span class="mi">2025</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">20</span><span class="p">))</span>
<a href="#__codelineno-8-16" id="__codelineno-8-16" name="__codelineno-8-16"></a>
<a href="#__codelineno-8-17" id="__codelineno-8-17" name="__codelineno-8-17"></a><span class="nb">print</span><span class="p">(</span><span class="s2">"Credit Arbitrage Position:"</span><span class="p">)</span>
<a href="#__codelineno-8-18" id="__codelineno-8-18" name="__codelineno-8-18"></a><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"  Long CDS A: $</span><span class="si">{</span><span class="n">npv_long</span><span class="si">:</span><span class="s2">,.2f</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
<a href="#__codelineno-8-19" id="__codelineno-8-19" name="__codelineno-8-19"></a><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"  Short CDS B: $</span><span class="si">{</span><span class="n">npv_short</span><span class="si">:</span><span class="s2">,.2f</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
<a href="#__codelineno-8-20" id="__codelineno-8-20" name="__codelineno-8-20"></a><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"  Combined P&amp;L: $</span><span class="si">{</span><span class="n">npv_long</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">npv_short</span><span class="si">:</span><span class="s2">,.2f</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
</code></pre></div>
<h3 id="3-credit-curve-trading">3. Credit Curve Trading<a class="headerlink" href="#3-credit-curve-trading" title="Permanent link">¬∂</a></h3>
<div class="highlight"><pre><span></span><code><a href="#__codelineno-9-1" id="__codelineno-9-1" name="__codelineno-9-1"></a><span class="c1"># CDS curve: 1Y, 3Y, 5Y, 10Y</span>
<a href="#__codelineno-9-2" id="__codelineno-9-2" name="__codelineno-9-2"></a><span class="n">maturities</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">10</span><span class="p">]</span>
<a href="#__codelineno-9-3" id="__codelineno-9-3" name="__codelineno-9-3"></a><span class="n">spreads</span> <span class="o">=</span> <span class="p">[</span><span class="mi">100</span><span class="p">,</span> <span class="mi">180</span><span class="p">,</span> <span class="mi">250</span><span class="p">,</span> <span class="mi">350</span><span class="p">]</span>  <span class="c1"># bps</span>
<a href="#__codelineno-9-4" id="__codelineno-9-4" name="__codelineno-9-4"></a>
<a href="#__codelineno-9-5" id="__codelineno-9-5" name="__codelineno-9-5"></a><span class="nb">print</span><span class="p">(</span><span class="s2">"CDS Curve:"</span><span class="p">)</span>
<a href="#__codelineno-9-6" id="__codelineno-9-6" name="__codelineno-9-6"></a><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"</span><span class="si">{</span><span class="s1">'Tenor'</span><span class="si">:</span><span class="s2">&lt;10</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="s1">'Spread'</span><span class="si">:</span><span class="s2">&lt;12</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="s1">'Hazard Rate'</span><span class="si">:</span><span class="s2">&lt;15</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="s1">'Default Prob'</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
<a href="#__codelineno-9-7" id="__codelineno-9-7" name="__codelineno-9-7"></a><span class="nb">print</span><span class="p">(</span><span class="s2">"-"</span> <span class="o">*</span> <span class="mi">60</span><span class="p">)</span>
<a href="#__codelineno-9-8" id="__codelineno-9-8" name="__codelineno-9-8"></a>
<a href="#__codelineno-9-9" id="__codelineno-9-9" name="__codelineno-9-9"></a><span class="k">for</span> <span class="n">tenor</span><span class="p">,</span> <span class="n">spread</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">maturities</span><span class="p">,</span> <span class="n">spreads</span><span class="p">):</span>
<a href="#__codelineno-9-10" id="__codelineno-9-10" name="__codelineno-9-10"></a>    <span class="n">maturity</span> <span class="o">=</span> <span class="n">datetime</span><span class="p">(</span><span class="mi">2025</span> <span class="o">+</span> <span class="n">tenor</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">20</span><span class="p">)</span>
<a href="#__codelineno-9-11" id="__codelineno-9-11" name="__codelineno-9-11"></a>    <span class="n">cds_temp</span> <span class="o">=</span> <span class="n">CreditDefaultSwap</span><span class="p">(</span>
<a href="#__codelineno-9-12" id="__codelineno-9-12" name="__codelineno-9-12"></a>        <span class="mi">10_000_000</span><span class="p">,</span> <span class="n">spread</span><span class="p">,</span> <span class="mf">0.40</span><span class="p">,</span>
<a href="#__codelineno-9-13" id="__codelineno-9-13" name="__codelineno-9-13"></a>        <span class="n">datetime</span><span class="p">(</span><span class="mi">2025</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">20</span><span class="p">),</span> <span class="n">maturity</span>
<a href="#__codelineno-9-14" id="__codelineno-9-14" name="__codelineno-9-14"></a>    <span class="p">)</span>
<a href="#__codelineno-9-15" id="__codelineno-9-15" name="__codelineno-9-15"></a>    <span class="n">hazard</span> <span class="o">=</span> <span class="n">cds_temp</span><span class="o">.</span><span class="n">bootstrap_hazard_rate_from_spread</span><span class="p">(</span><span class="mf">0.05</span><span class="p">)</span>
<a href="#__codelineno-9-16" id="__codelineno-9-16" name="__codelineno-9-16"></a>    <span class="n">default_prob</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">-</span> <span class="n">cds_temp</span><span class="o">.</span><span class="n">calculate_survival_probability</span><span class="p">(</span><span class="n">hazard</span><span class="p">,</span> <span class="n">tenor</span><span class="p">)</span>
<a href="#__codelineno-9-17" id="__codelineno-9-17" name="__codelineno-9-17"></a>
<a href="#__codelineno-9-18" id="__codelineno-9-18" name="__codelineno-9-18"></a>    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"</span><span class="si">{</span><span class="n">tenor</span><span class="si">}</span><span class="s2">Y</span><span class="si">{</span><span class="s1">''</span><span class="si">:</span><span class="s2">&lt;8</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">spread</span><span class="si">:</span><span class="s2">&gt;6</span><span class="si">}</span><span class="s2"> bps </span><span class="si">{</span><span class="n">hazard</span><span class="o">*</span><span class="mi">100</span><span class="si">:</span><span class="s2">&gt;11.4f</span><span class="si">}</span><span class="s2">% </span><span class="si">{</span><span class="n">default_prob</span><span class="o">*</span><span class="mi">100</span><span class="si">:</span><span class="s2">&gt;11.2f</span><span class="si">}</span><span class="s2">%"</span><span class="p">)</span>
</code></pre></div>
<h2 id="advanced-pricing-with-quantlib">üìà Advanced Pricing with QuantLib<a class="headerlink" href="#advanced-pricing-with-quantlib" title="Permanent link">¬∂</a></h2>
<div class="highlight"><pre><span></span><code><a href="#__codelineno-10-1" id="__codelineno-10-1" name="__codelineno-10-1"></a><span class="kn">import</span><span class="w"> </span><span class="nn">QuantLib</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">ql</span>
<a href="#__codelineno-10-2" id="__codelineno-10-2" name="__codelineno-10-2"></a>
<a href="#__codelineno-10-3" id="__codelineno-10-3" name="__codelineno-10-3"></a><span class="k">def</span><span class="w"> </span><span class="nf">price_cds_with_quantlib</span><span class="p">(</span>
<a href="#__codelineno-10-4" id="__codelineno-10-4" name="__codelineno-10-4"></a>    <span class="n">notional</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
<a href="#__codelineno-10-5" id="__codelineno-10-5" name="__codelineno-10-5"></a>    <span class="n">spread</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>  <span class="c1"># in bps</span>
<a href="#__codelineno-10-6" id="__codelineno-10-6" name="__codelineno-10-6"></a>    <span class="n">recovery_rate</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
<a href="#__codelineno-10-7" id="__codelineno-10-7" name="__codelineno-10-7"></a>    <span class="n">start_date</span><span class="p">:</span> <span class="n">datetime</span><span class="p">,</span>
<a href="#__codelineno-10-8" id="__codelineno-10-8" name="__codelineno-10-8"></a>    <span class="n">maturity_date</span><span class="p">:</span> <span class="n">datetime</span><span class="p">,</span>
<a href="#__codelineno-10-9" id="__codelineno-10-9" name="__codelineno-10-9"></a>    <span class="n">hazard_rate</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
<a href="#__codelineno-10-10" id="__codelineno-10-10" name="__codelineno-10-10"></a>    <span class="n">discount_rate</span><span class="p">:</span> <span class="nb">float</span>
<a href="#__codelineno-10-11" id="__codelineno-10-11" name="__codelineno-10-11"></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
<a href="#__codelineno-10-12" id="__codelineno-10-12" name="__codelineno-10-12"></a><span class="w">    </span><span class="sd">"""</span>
<a href="#__codelineno-10-13" id="__codelineno-10-13" name="__codelineno-10-13"></a><span class="sd">    Price CDS using QuantLib</span>
<a href="#__codelineno-10-14" id="__codelineno-10-14" name="__codelineno-10-14"></a>
<a href="#__codelineno-10-15" id="__codelineno-10-15" name="__codelineno-10-15"></a><span class="sd">    Returns:</span>
<a href="#__codelineno-10-16" id="__codelineno-10-16" name="__codelineno-10-16"></a><span class="sd">        Dictionary with NPV, fair spread, DV01</span>
<a href="#__codelineno-10-17" id="__codelineno-10-17" name="__codelineno-10-17"></a><span class="sd">    """</span>
<a href="#__codelineno-10-18" id="__codelineno-10-18" name="__codelineno-10-18"></a>    <span class="c1"># Convert dates</span>
<a href="#__codelineno-10-19" id="__codelineno-10-19" name="__codelineno-10-19"></a>    <span class="n">ql_start</span> <span class="o">=</span> <span class="n">ql</span><span class="o">.</span><span class="n">Date</span><span class="p">(</span><span class="n">start_date</span><span class="o">.</span><span class="n">day</span><span class="p">,</span> <span class="n">start_date</span><span class="o">.</span><span class="n">month</span><span class="p">,</span> <span class="n">start_date</span><span class="o">.</span><span class="n">year</span><span class="p">)</span>
<a href="#__codelineno-10-20" id="__codelineno-10-20" name="__codelineno-10-20"></a>    <span class="n">ql_maturity</span> <span class="o">=</span> <span class="n">ql</span><span class="o">.</span><span class="n">Date</span><span class="p">(</span><span class="n">maturity_date</span><span class="o">.</span><span class="n">day</span><span class="p">,</span> <span class="n">maturity_date</span><span class="o">.</span><span class="n">month</span><span class="p">,</span> <span class="n">maturity_date</span><span class="o">.</span><span class="n">year</span><span class="p">)</span>
<a href="#__codelineno-10-21" id="__codelineno-10-21" name="__codelineno-10-21"></a>
<a href="#__codelineno-10-22" id="__codelineno-10-22" name="__codelineno-10-22"></a>    <span class="c1"># Set evaluation date</span>
<a href="#__codelineno-10-23" id="__codelineno-10-23" name="__codelineno-10-23"></a>    <span class="n">ql</span><span class="o">.</span><span class="n">Settings</span><span class="o">.</span><span class="n">instance</span><span class="p">()</span><span class="o">.</span><span class="n">evaluationDate</span> <span class="o">=</span> <span class="n">ql_start</span>
<a href="#__codelineno-10-24" id="__codelineno-10-24" name="__codelineno-10-24"></a>
<a href="#__codelineno-10-25" id="__codelineno-10-25" name="__codelineno-10-25"></a>    <span class="c1"># Create schedule</span>
<a href="#__codelineno-10-26" id="__codelineno-10-26" name="__codelineno-10-26"></a>    <span class="n">schedule</span> <span class="o">=</span> <span class="n">ql</span><span class="o">.</span><span class="n">Schedule</span><span class="p">(</span>
<a href="#__codelineno-10-27" id="__codelineno-10-27" name="__codelineno-10-27"></a>        <span class="n">ql_start</span><span class="p">,</span>
<a href="#__codelineno-10-28" id="__codelineno-10-28" name="__codelineno-10-28"></a>        <span class="n">ql_maturity</span><span class="p">,</span>
<a href="#__codelineno-10-29" id="__codelineno-10-29" name="__codelineno-10-29"></a>        <span class="n">ql</span><span class="o">.</span><span class="n">Period</span><span class="p">(</span><span class="n">ql</span><span class="o">.</span><span class="n">Quarterly</span><span class="p">),</span>
<a href="#__codelineno-10-30" id="__codelineno-10-30" name="__codelineno-10-30"></a>        <span class="n">ql</span><span class="o">.</span><span class="n">NullCalendar</span><span class="p">(),</span>
<a href="#__codelineno-10-31" id="__codelineno-10-31" name="__codelineno-10-31"></a>        <span class="n">ql</span><span class="o">.</span><span class="n">Following</span><span class="p">,</span>
<a href="#__codelineno-10-32" id="__codelineno-10-32" name="__codelineno-10-32"></a>        <span class="n">ql</span><span class="o">.</span><span class="n">Unadjusted</span><span class="p">,</span>
<a href="#__codelineno-10-33" id="__codelineno-10-33" name="__codelineno-10-33"></a>        <span class="n">ql</span><span class="o">.</span><span class="n">DateGeneration</span><span class="o">.</span><span class="n">Forward</span><span class="p">,</span>
<a href="#__codelineno-10-34" id="__codelineno-10-34" name="__codelineno-10-34"></a>        <span class="kc">False</span>
<a href="#__codelineno-10-35" id="__codelineno-10-35" name="__codelineno-10-35"></a>    <span class="p">)</span>
<a href="#__codelineno-10-36" id="__codelineno-10-36" name="__codelineno-10-36"></a>
<a href="#__codelineno-10-37" id="__codelineno-10-37" name="__codelineno-10-37"></a>    <span class="c1"># Create CDS</span>
<a href="#__codelineno-10-38" id="__codelineno-10-38" name="__codelineno-10-38"></a>    <span class="n">cds</span> <span class="o">=</span> <span class="n">ql</span><span class="o">.</span><span class="n">CreditDefaultSwap</span><span class="p">(</span>
<a href="#__codelineno-10-39" id="__codelineno-10-39" name="__codelineno-10-39"></a>        <span class="n">ql</span><span class="o">.</span><span class="n">Protection</span><span class="o">.</span><span class="n">Buyer</span><span class="p">,</span>
<a href="#__codelineno-10-40" id="__codelineno-10-40" name="__codelineno-10-40"></a>        <span class="n">notional</span><span class="p">,</span>
<a href="#__codelineno-10-41" id="__codelineno-10-41" name="__codelineno-10-41"></a>        <span class="n">spread</span> <span class="o">/</span> <span class="mf">10000.0</span><span class="p">,</span>  <span class="c1"># Convert bps to decimal</span>
<a href="#__codelineno-10-42" id="__codelineno-10-42" name="__codelineno-10-42"></a>        <span class="n">schedule</span><span class="p">,</span>
<a href="#__codelineno-10-43" id="__codelineno-10-43" name="__codelineno-10-43"></a>        <span class="n">ql</span><span class="o">.</span><span class="n">Following</span><span class="p">,</span>
<a href="#__codelineno-10-44" id="__codelineno-10-44" name="__codelineno-10-44"></a>        <span class="n">ql</span><span class="o">.</span><span class="n">Actual360</span><span class="p">()</span>
<a href="#__codelineno-10-45" id="__codelineno-10-45" name="__codelineno-10-45"></a>    <span class="p">)</span>
<a href="#__codelineno-10-46" id="__codelineno-10-46" name="__codelineno-10-46"></a>
<a href="#__codelineno-10-47" id="__codelineno-10-47" name="__codelineno-10-47"></a>    <span class="c1"># Create default probability term structure</span>
<a href="#__codelineno-10-48" id="__codelineno-10-48" name="__codelineno-10-48"></a>    <span class="n">hazard_curve</span> <span class="o">=</span> <span class="n">ql</span><span class="o">.</span><span class="n">FlatHazardRate</span><span class="p">(</span>
<a href="#__codelineno-10-49" id="__codelineno-10-49" name="__codelineno-10-49"></a>        <span class="n">ql_start</span><span class="p">,</span>
<a href="#__codelineno-10-50" id="__codelineno-10-50" name="__codelineno-10-50"></a>        <span class="n">hazard_rate</span><span class="p">,</span>
<a href="#__codelineno-10-51" id="__codelineno-10-51" name="__codelineno-10-51"></a>        <span class="n">ql</span><span class="o">.</span><span class="n">Actual365Fixed</span><span class="p">()</span>
<a href="#__codelineno-10-52" id="__codelineno-10-52" name="__codelineno-10-52"></a>    <span class="p">)</span>
<a href="#__codelineno-10-53" id="__codelineno-10-53" name="__codelineno-10-53"></a>
<a href="#__codelineno-10-54" id="__codelineno-10-54" name="__codelineno-10-54"></a>    <span class="c1"># Create discount curve</span>
<a href="#__codelineno-10-55" id="__codelineno-10-55" name="__codelineno-10-55"></a>    <span class="n">discount_curve</span> <span class="o">=</span> <span class="n">ql</span><span class="o">.</span><span class="n">FlatForward</span><span class="p">(</span>
<a href="#__codelineno-10-56" id="__codelineno-10-56" name="__codelineno-10-56"></a>        <span class="n">ql_start</span><span class="p">,</span>
<a href="#__codelineno-10-57" id="__codelineno-10-57" name="__codelineno-10-57"></a>        <span class="n">discount_rate</span><span class="p">,</span>
<a href="#__codelineno-10-58" id="__codelineno-10-58" name="__codelineno-10-58"></a>        <span class="n">ql</span><span class="o">.</span><span class="n">Actual365Fixed</span><span class="p">()</span>
<a href="#__codelineno-10-59" id="__codelineno-10-59" name="__codelineno-10-59"></a>    <span class="p">)</span>
<a href="#__codelineno-10-60" id="__codelineno-10-60" name="__codelineno-10-60"></a>
<a href="#__codelineno-10-61" id="__codelineno-10-61" name="__codelineno-10-61"></a>    <span class="c1"># Set pricing engine</span>
<a href="#__codelineno-10-62" id="__codelineno-10-62" name="__codelineno-10-62"></a>    <span class="n">engine</span> <span class="o">=</span> <span class="n">ql</span><span class="o">.</span><span class="n">MidPointCdsEngine</span><span class="p">(</span>
<a href="#__codelineno-10-63" id="__codelineno-10-63" name="__codelineno-10-63"></a>        <span class="n">ql</span><span class="o">.</span><span class="n">DefaultProbabilityTermStructureHandle</span><span class="p">(</span><span class="n">hazard_curve</span><span class="p">),</span>
<a href="#__codelineno-10-64" id="__codelineno-10-64" name="__codelineno-10-64"></a>        <span class="n">recovery_rate</span><span class="p">,</span>
<a href="#__codelineno-10-65" id="__codelineno-10-65" name="__codelineno-10-65"></a>        <span class="n">ql</span><span class="o">.</span><span class="n">YieldTermStructureHandle</span><span class="p">(</span><span class="n">discount_curve</span><span class="p">)</span>
<a href="#__codelineno-10-66" id="__codelineno-10-66" name="__codelineno-10-66"></a>    <span class="p">)</span>
<a href="#__codelineno-10-67" id="__codelineno-10-67" name="__codelineno-10-67"></a>
<a href="#__codelineno-10-68" id="__codelineno-10-68" name="__codelineno-10-68"></a>    <span class="n">cds</span><span class="o">.</span><span class="n">setPricingEngine</span><span class="p">(</span><span class="n">engine</span><span class="p">)</span>
<a href="#__codelineno-10-69" id="__codelineno-10-69" name="__codelineno-10-69"></a>
<a href="#__codelineno-10-70" id="__codelineno-10-70" name="__codelineno-10-70"></a>    <span class="k">return</span> <span class="p">{</span>
<a href="#__codelineno-10-71" id="__codelineno-10-71" name="__codelineno-10-71"></a>        <span class="s1">'npv'</span><span class="p">:</span> <span class="n">cds</span><span class="o">.</span><span class="n">NPV</span><span class="p">(),</span>
<a href="#__codelineno-10-72" id="__codelineno-10-72" name="__codelineno-10-72"></a>        <span class="s1">'fair_spread'</span><span class="p">:</span> <span class="n">cds</span><span class="o">.</span><span class="n">fairSpread</span><span class="p">()</span> <span class="o">*</span> <span class="mi">10000</span><span class="p">,</span>  <span class="c1"># Convert to bps</span>
<a href="#__codelineno-10-73" id="__codelineno-10-73" name="__codelineno-10-73"></a>        <span class="s1">'default_probability'</span><span class="p">:</span> <span class="mi">1</span> <span class="o">-</span> <span class="n">hazard_curve</span><span class="o">.</span><span class="n">survivalProbability</span><span class="p">(</span><span class="n">ql_maturity</span><span class="p">)</span>
<a href="#__codelineno-10-74" id="__codelineno-10-74" name="__codelineno-10-74"></a>    <span class="p">}</span>
</code></pre></div>
<h2 id="related-instruments">üîó Related Instruments<a class="headerlink" href="#related-instruments" title="Permanent link">¬∂</a></h2>
<ul>
<li><a href="../cds_index/">CDS Index</a> - Portfolio of CDS contracts</li>
<li><a href="../cdx_options/">CDX/iTraxx Options</a> - Options on CDS indices</li>
<li><a href="../../equity/equity_swap/">Total Return Swap</a> - Alternative credit exposure</li>
</ul>
<h2 id="references">üìö References<a class="headerlink" href="#references" title="Permanent link">¬∂</a></h2>
<ul>
<li>ISDA Documentation - <a href="https://www.isda.org/">CDS Standard Model</a></li>
<li>O'Kane, D. (2008). <em>Modelling Single-name and Multi-name Credit Derivatives</em></li>
<li><a href="https://www.quantlib.org/">QuantLib Credit Risk Documentation</a></li>
</ul>
<h2 id="important-notes">‚ö†Ô∏è Important Notes<a class="headerlink" href="#important-notes" title="Permanent link">¬∂</a></h2>
<div class="admonition warning">
<p class="admonition-title">Counterparty Risk</p>
<p>CDS contracts have significant counterparty risk - protection seller may default</p>
</div>
<div class="admonition info">
<p class="admonition-title">Wrong-Way Risk</p>
<p>CDS value and counterparty credit quality may be correlated</p>
</div>
<div class="admonition tip">
<p class="admonition-title">ISDA Standard</p>
<p>Use ISDA standard model for pricing consistency with market</p>
</div>
<div class="admonition danger">
<p class="admonition-title">Jump-to-Default Risk</p>
<p>Sudden credit events can cause large losses for protection sellers</p>
</div>
<hr/>
<p><strong>Last Updated:</strong> 2025-01-17 | <strong>Version:</strong> 1.0 | <strong>Status:</strong> Production Ready</p>
</article>
</div>
<script>var tabs=__md_get("__tabs");if(Array.isArray(tabs))e:for(var set of document.querySelectorAll(".tabbed-set")){var labels=set.querySelector(".tabbed-labels");for(var tab of tabs)for(var label of labels.getElementsByTagName("label"))if(label.innerText.trim()===tab){var input=document.getElementById(label.htmlFor);input.checked=!0;continue e}}</script>
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
</div>
<button class="md-top md-icon" data-md-component="top" hidden="" type="button">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8z"></path></svg>
  Back to top
</button>
</main>
<footer class="md-footer">
<div class="md-footer-meta md-typeset">
<div class="md-footer-meta__inner md-grid">
<div class="md-copyright">
<div class="md-copyright__highlight">
      Copyright ¬© 2025 David Forero
    </div>
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" rel="noopener" target="_blank">
      Material for MkDocs
    </a>
</div>
</div>
</div>
</footer>
</div>
<div class="md-dialog" data-md-component="dialog">
<div class="md-dialog__inner md-typeset"></div>
</div>
<script id="__config" type="application/json">{"base": "../../..", "features": ["navigation.instant", "navigation.tracking", "navigation.tabs", "navigation.tabs.sticky", "navigation.sections", "navigation.expand", "navigation.indexes", "navigation.top", "toc.follow", "toc.integrate", "search.suggest", "search.highlight", "search.share", "content.code.copy", "content.code.annotate", "content.tabs.link", "header.autohide"], "search": "../../../assets/javascripts/workers/search.6ce7567c.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script>
<script src="../../../assets/javascripts/bundle.83f73b43.min.js"></script>
<script src="https://unpkg.com/mermaid@10.0.2/dist/mermaid.min.js"></script>
<script src="../../../assets/javascripts/mathjax.js"></script>
<script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
<script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
</body>
</html>